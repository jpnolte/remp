<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Kapitel 6 Datenvorbereitung | R für empirische Wissenschaften</title>
  <meta name="description" content="Dieses Buch bietet einfache Erklärungen mit praktischen Beispielen und Übungen, welche das Erlernen von R ohne Programmiervorkenntnisse im Selbststudium ermöglichen. Die Zielgruppe sind WissenschaftlerInnen und StudentInnen der Fachrichtungen Medizin, Psychologie, Wirtschaftswissenschaften, Sozialwissenschaften, Agrarwissenschaften, Neurowissenschaften, Biologie, Journalismus, Tourismus, Data Science, Biostatistik und allen weiteren Disziplinen, die Daten auswerten möchten." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Kapitel 6 Datenvorbereitung | R für empirische Wissenschaften" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/logo.png" />
  <meta property="og:description" content="Dieses Buch bietet einfache Erklärungen mit praktischen Beispielen und Übungen, welche das Erlernen von R ohne Programmiervorkenntnisse im Selbststudium ermöglichen. Die Zielgruppe sind WissenschaftlerInnen und StudentInnen der Fachrichtungen Medizin, Psychologie, Wirtschaftswissenschaften, Sozialwissenschaften, Agrarwissenschaften, Neurowissenschaften, Biologie, Journalismus, Tourismus, Data Science, Biostatistik und allen weiteren Disziplinen, die Daten auswerten möchten." />
  <meta name="github-repo" content="j3ypi/remp" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Kapitel 6 Datenvorbereitung | R für empirische Wissenschaften" />
  
  <meta name="twitter:description" content="Dieses Buch bietet einfache Erklärungen mit praktischen Beispielen und Übungen, welche das Erlernen von R ohne Programmiervorkenntnisse im Selbststudium ermöglichen. Die Zielgruppe sind WissenschaftlerInnen und StudentInnen der Fachrichtungen Medizin, Psychologie, Wirtschaftswissenschaften, Sozialwissenschaften, Agrarwissenschaften, Neurowissenschaften, Biologie, Journalismus, Tourismus, Data Science, Biostatistik und allen weiteren Disziplinen, die Daten auswerten möchten." />
  <meta name="twitter:image" content="/images/logo.png" />

<meta name="author" content="Jan Philipp Nolte" />


<meta name="date" content="2023-05-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="io.html"/>
<link rel="next" href="descr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils/js/key-buttons.min.js" defer></script>
<link href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/key-buttons.min.css" rel="stylesheet"></link>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { } /* Alert */
code span.an { } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { } /* ControlFlow */
code span.ch { color: #0e7a0e; } /* Char */
code span.cn { } /* Constant */
code span.co { } /* Comment */
code span.cv { color: #0e7a0e; } /* CommentVar */
code span.do { } /* Documentation */
code span.er { font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fu { color: #e65100; } /* Function */
code span.im { } /* Import */
code span.in { } /* Information */
code span.kw { color: #e65100; } /* Keyword */
code span.op { } /* Operator */
code span.ot { } /* Other */
code span.pp { } /* Preprocessor */
code span.sc { } /* SpecialChar */
code span.ss { } /* SpecialString */
code span.st { color: #0e7a0e; } /* String */
code span.va { } /* Variable */
code span.vs { color: #0e7a0e; } /* VerbatimString */
code span.wa { font-weight: bold; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="https://r-empirische-wissenschaften.de"> R für empirische Wissenschaften</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Vorwort</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#lizenz"><i class="fa fa-check"></i>Lizenz</a></li>
</ul></li>
<li class="part"><span><b>I Die ersten Schritte</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Einleitung</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#für-wen-ist-dieses-buch"><i class="fa fa-check"></i><b>1.1</b> Für wen ist dieses Buch?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#aufbau-und-bearbeitungsstrategie"><i class="fa fa-check"></i><b>1.2</b> Aufbau und Bearbeitungsstrategie</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#boxen-übungen-und-datensätze"><i class="fa fa-check"></i><b>1.3</b> Boxen, Übungen und Datensätze</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#books"><i class="fa fa-check"></i><b>1.4</b> Ergänzende Literatur</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>2</b> Startvoraussetzungen</a>
<ul>
<li class="chapter" data-level="2.1" data-path="start.html"><a href="start.html#installation-von-r-und-rstudio"><i class="fa fa-check"></i><b>2.1</b> Installation von R und RStudio</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="start.html"><a href="start.html#installr"><i class="fa fa-check"></i><b>2.1.1</b> Programmiersprache R</a></li>
<li class="chapter" data-level="2.1.2" data-path="start.html"><a href="start.html#rstudio"><i class="fa fa-check"></i><b>2.1.2</b> Programmierumgebung RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="start.html"><a href="start.html#aufbau"><i class="fa fa-check"></i><b>2.2</b> Aufbau von RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="start.html"><a href="start.html#anpassung"><i class="fa fa-check"></i><b>2.3</b> RStudio anpassen</a></li>
<li class="chapter" data-level="2.4" data-path="start.html"><a href="start.html#funktionen-und-ihre-argumente"><i class="fa fa-check"></i><b>2.4</b> Funktionen und ihre Argumente</a></li>
<li class="chapter" data-level="2.5" data-path="start.html"><a href="start.html#packages"><i class="fa fa-check"></i><b>2.5</b> Packages (Erweiterungen)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="start.html"><a href="start.html#installieren-und-laden"><i class="fa fa-check"></i><b>2.5.1</b> Installieren und laden</a></li>
<li class="chapter" data-level="2.5.2" data-path="start.html"><a href="start.html#notwendige-packages-für-dieses-buch"><i class="fa fa-check"></i><b>2.5.2</b> Notwendige Packages für dieses Buch</a></li>
<li class="chapter" data-level="2.5.3" data-path="start.html"><a href="start.html#namespace"><i class="fa fa-check"></i><b>2.5.3</b> Namespace</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="start.html"><a href="start.html#help"><i class="fa fa-check"></i><b>2.6</b> Fehler- und Warnmeldungen</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="start.html"><a href="start.html#der-unterschied"><i class="fa fa-check"></i><b>2.6.1</b> Der Unterschied</a></li>
<li class="chapter" data-level="2.6.2" data-path="start.html"><a href="start.html#hilfe"><i class="fa fa-check"></i><b>2.6.2</b> Wo bekomme ich Hilfe?</a></li>
<li class="chapter" data-level="2.6.3" data-path="start.html"><a href="start.html#fehler-beheben"><i class="fa fa-check"></i><b>2.6.3</b> Fehler beheben</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Vorbereitung</b></span></li>
<li class="chapter" data-level="3" data-path="project.html"><a href="project.html"><i class="fa fa-check"></i><b>3</b> R Projekte</a>
<ul>
<li class="chapter" data-level="3.1" data-path="project.html"><a href="project.html#die-probleme-der-pfade"><i class="fa fa-check"></i><b>3.1</b> Die Probleme der Pfade</a></li>
<li class="chapter" data-level="3.2" data-path="project.html"><a href="project.html#projekte-in-rstudio-erstellen"><i class="fa fa-check"></i><b>3.2</b> Projekte in RStudio erstellen</a></li>
<li class="chapter" data-level="3.3" data-path="project.html"><a href="project.html#here"><i class="fa fa-check"></i><b>3.3</b> Der Pfad zum Datensatz</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vars.html"><a href="vars.html"><i class="fa fa-check"></i><b>4</b> Wichtiges Grundlagenwissen</a>
<ul>
<li class="chapter" data-level="4.1" data-path="vars.html"><a href="vars.html#begin"><i class="fa fa-check"></i><b>4.1</b> Schritt für Schritt beginnen</a></li>
<li class="chapter" data-level="4.2" data-path="vars.html"><a href="vars.html#pfeil"><i class="fa fa-check"></i><b>4.2</b> Variablen speichern und verwenden</a></li>
<li class="chapter" data-level="4.3" data-path="vars.html"><a href="vars.html#datentypen"><i class="fa fa-check"></i><b>4.3</b> Datentypen</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="vars.html"><a href="vars.html#zahlen-buchstaben-und-logische-abfragen"><i class="fa fa-check"></i><b>4.3.1</b> Zahlen, Buchstaben und logische Abfragen</a></li>
<li class="chapter" data-level="4.3.2" data-path="vars.html"><a href="vars.html#factor"><i class="fa fa-check"></i><b>4.3.2</b> Faktoren</a></li>
<li class="chapter" data-level="4.3.3" data-path="vars.html"><a href="vars.html#zeitdaten"><i class="fa fa-check"></i><b>4.3.3</b> Zeitdaten</a></li>
<li class="chapter" data-level="4.3.4" data-path="vars.html"><a href="vars.html#datentypen-konvertieren"><i class="fa fa-check"></i><b>4.3.4</b> Datentypen konvertieren</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="vars.html"><a href="vars.html#struktur-von-datensätzen"><i class="fa fa-check"></i><b>4.4</b> Struktur von Datensätzen</a></li>
<li class="chapter" data-level="4.5" data-path="vars.html"><a href="vars.html#dollar"><i class="fa fa-check"></i><b>4.5</b> Der Dollar-Operator</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>5</b> Datensätze</a>
<ul>
<li class="chapter" data-level="5.1" data-path="io.html"><a href="io.html#import"><i class="fa fa-check"></i><b>5.1</b> Einlesen externer Dateien</a></li>
<li class="chapter" data-level="5.2" data-path="io.html"><a href="io.html#datensätze-aus-packages-laden"><i class="fa fa-check"></i><b>5.2</b> Datensätze aus Packages laden</a></li>
<li class="chapter" data-level="5.3" data-path="io.html"><a href="io.html#inR"><i class="fa fa-check"></i><b>5.3</b> Datensätze in R erstellen</a></li>
<li class="chapter" data-level="5.4" data-path="io.html"><a href="io.html#speichern-und-konvertieren"><i class="fa fa-check"></i><b>5.4</b> Speichern und Konvertieren</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html"><i class="fa fa-check"></i><b>6</b> Datenvorbereitung</a>
<ul>
<li class="chapter" data-level="6.1" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#tidyverse"><i class="fa fa-check"></i><b>6.1</b> Einführung</a></li>
<li class="chapter" data-level="6.2" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#select"><i class="fa fa-check"></i><b>6.2</b> Spalten auswählen, umbenennen und umsortieren</a></li>
<li class="chapter" data-level="6.3" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#filter"><i class="fa fa-check"></i><b>6.3</b> Zeilen auswählen und umsortieren</a></li>
<li class="chapter" data-level="6.4" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#mutate"><i class="fa fa-check"></i><b>6.4</b> Spalten hinzufügen und Spalteninhalte verändern</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#single"><i class="fa fa-check"></i><b>6.4.1</b> Einzelne Spalten</a></li>
<li class="chapter" data-level="6.4.2" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#across"><i class="fa fa-check"></i><b>6.4.2</b> Mehrere Spalten</a></li>
<li class="chapter" data-level="6.4.3" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#helfer"><i class="fa fa-check"></i><b>6.4.3</b> Änderungen unter Bedingungen</a></li>
<li class="chapter" data-level="6.4.4" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#function"><i class="fa fa-check"></i><b>6.4.4</b> Eigene Funktionen erstellen</a></li>
<li class="chapter" data-level="6.4.5" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#zeilenweise-berechnen"><i class="fa fa-check"></i><b>6.4.5</b> Zeilenweise berechnen</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#umgang-mit-fehlenden-werten-und-duplikaten"><i class="fa fa-check"></i><b>6.5</b> Umgang mit fehlenden Werten und Duplikaten</a></li>
<li class="chapter" data-level="6.6" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#tidy"><i class="fa fa-check"></i><b>6.6</b> Breites und langes Datenformat</a></li>
<li class="chapter" data-level="6.7" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#separate"><i class="fa fa-check"></i><b>6.7</b> Spalten trennen</a></li>
<li class="chapter" data-level="6.8" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#datensätze-zusammenführen"><i class="fa fa-check"></i><b>6.8</b> Datensätze zusammenführen</a></li>
<li class="chapter" data-level="6.9" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#datastring"><i class="fa fa-check"></i><b>6.9</b> Buchstaben und Wörter bearbeiten</a></li>
<li class="chapter" data-level="6.10" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#datafactor"><i class="fa fa-check"></i><b>6.10</b> Faktoren verändern</a></li>
<li class="chapter" data-level="6.11" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#datazeit"><i class="fa fa-check"></i><b>6.11</b> Mit Zeitdaten arbeiten</a></li>
<li class="chapter" data-level="6.12" data-path="datenvorbereitung.html"><a href="datenvorbereitung.html#binäre-antwortmatrix-erstellen"><i class="fa fa-check"></i><b>6.12</b> Binäre Antwortmatrix erstellen</a></li>
</ul></li>
<li class="part"><span><b>III Auswertung</b></span></li>
<li class="chapter" data-level="7" data-path="descr.html"><a href="descr.html"><i class="fa fa-check"></i><b>7</b> Deskriptive Statistik</a>
<ul>
<li class="chapter" data-level="7.1" data-path="descr.html"><a href="descr.html#lagestreu"><i class="fa fa-check"></i><b>7.1</b> Lagemaße und Streuungsmaße</a></li>
<li class="chapter" data-level="7.2" data-path="descr.html"><a href="descr.html#contigency"><i class="fa fa-check"></i><b>7.2</b> Häufigkeiten und Kontingenztafeln</a></li>
<li class="chapter" data-level="7.3" data-path="descr.html"><a href="descr.html#cor"><i class="fa fa-check"></i><b>7.3</b> Zusammenhangsmaße</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visual.html"><a href="visual.html"><i class="fa fa-check"></i><b>8</b> Visualisierungen</a>
<ul>
<li class="chapter" data-level="8.1" data-path="visual.html"><a href="visual.html#einführung"><i class="fa fa-check"></i><b>8.1</b> Einführung</a></li>
<li class="chapter" data-level="8.2" data-path="visual.html"><a href="visual.html#histogram"><i class="fa fa-check"></i><b>8.2</b> Histogramm und Dichte</a></li>
<li class="chapter" data-level="8.3" data-path="visual.html"><a href="visual.html#scatter"><i class="fa fa-check"></i><b>8.3</b> Streudiagramm</a></li>
<li class="chapter" data-level="8.4" data-path="visual.html"><a href="visual.html#boxplot"><i class="fa fa-check"></i><b>8.4</b> Boxplot</a></li>
<li class="chapter" data-level="8.5" data-path="visual.html"><a href="visual.html#violin"><i class="fa fa-check"></i><b>8.5</b> Violin Plot</a></li>
<li class="chapter" data-level="8.6" data-path="visual.html"><a href="visual.html#barplot"><i class="fa fa-check"></i><b>8.6</b> Balkendiagramm</a></li>
<li class="chapter" data-level="8.7" data-path="visual.html"><a href="visual.html#anovaplot"><i class="fa fa-check"></i><b>8.7</b> Liniendiagramm</a></li>
<li class="chapter" data-level="8.8" data-path="visual.html"><a href="visual.html#qqplot"><i class="fa fa-check"></i><b>8.8</b> Quantil-Quantil Plot</a></li>
<li class="chapter" data-level="8.9" data-path="visual.html"><a href="visual.html#morefactors"><i class="fa fa-check"></i><b>8.9</b> Mehrfaktorielle Abbildungen</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="visual.html"><a href="visual.html#groups"><i class="fa fa-check"></i><b>8.9.1</b> Gruppierungsargumente</a></li>
<li class="chapter" data-level="8.9.2" data-path="visual.html"><a href="visual.html#facets"><i class="fa fa-check"></i><b>8.9.2</b> Facetten als weitere Dimensionen</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="visual.html"><a href="visual.html#adapt"><i class="fa fa-check"></i><b>8.10</b> Anpassen des Aussehens</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="visual.html"><a href="visual.html#color"><i class="fa fa-check"></i><b>8.10.1</b> Farben</a></li>
<li class="chapter" data-level="8.10.2" data-path="visual.html"><a href="visual.html#themeaxis"><i class="fa fa-check"></i><b>8.10.2</b> Themen und Achsen</a></li>
<li class="chapter" data-level="8.10.3" data-path="visual.html"><a href="visual.html#legende-und-facetten"><i class="fa fa-check"></i><b>8.10.3</b> Legende und Facetten</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="visual.html"><a href="visual.html#patch"><i class="fa fa-check"></i><b>8.11</b> Anordnen mehrerer Graphen</a></li>
<li class="chapter" data-level="8.12" data-path="visual.html"><a href="visual.html#ggsave"><i class="fa fa-check"></i><b>8.12</b> Speichern von Abbildungen</a></li>
<li class="chapter" data-level="8.13" data-path="visual.html"><a href="visual.html#exemplarische-erweiterungen"><i class="fa fa-check"></i><b>8.13</b> Exemplarische Erweiterungen</a>
<ul>
<li class="chapter" data-level="8.13.1" data-path="visual.html"><a href="visual.html#kaplan"><i class="fa fa-check"></i><b>8.13.1</b> Kaplan-Meier-Kurve</a></li>
<li class="chapter" data-level="8.13.2" data-path="visual.html"><a href="visual.html#residuals"><i class="fa fa-check"></i><b>8.13.2</b> Residuen überprüfen</a></li>
<li class="chapter" data-level="8.13.3" data-path="visual.html"><a href="visual.html#ridgeline-plot"><i class="fa fa-check"></i><b>8.13.3</b> Ridgeline Plot</a></li>
</ul></li>
<li class="chapter" data-level="8.14" data-path="visual.html"><a href="visual.html#example"><i class="fa fa-check"></i><b>8.14</b> Anwendungsbeispiel</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="inductive.html"><a href="inductive.html"><i class="fa fa-check"></i><b>9</b> Inferenzstatistik</a>
<ul>
<li class="chapter" data-level="9.1" data-path="inductive.html"><a href="inductive.html#einführung-1"><i class="fa fa-check"></i><b>9.1</b> Einführung</a></li>
<li class="chapter" data-level="9.2" data-path="inductive.html"><a href="inductive.html#ein--und-zweistichprobenszenarien"><i class="fa fa-check"></i><b>9.2</b> Ein- und Zweistichprobenszenarien</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="inductive.html"><a href="inductive.html#ttest"><i class="fa fa-check"></i><b>9.2.1</b> <em>t</em> Test und Welch Test</a></li>
<li class="chapter" data-level="9.2.2" data-path="inductive.html"><a href="inductive.html#wilcoxon-test"><i class="fa fa-check"></i><b>9.2.2</b> Wilcoxon Test</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="inductive.html"><a href="inductive.html#unterschiede-mehrerer-gruppen"><i class="fa fa-check"></i><b>9.3</b> Unterschiede mehrerer Gruppen</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="inductive.html"><a href="inductive.html#aov"><i class="fa fa-check"></i><b>9.3.1</b> Varianz- und Kovarianzanalyse</a></li>
<li class="chapter" data-level="9.3.2" data-path="inductive.html"><a href="inductive.html#repeated"><i class="fa fa-check"></i><b>9.3.2</b> Varianzanalyse mit Messwiederholung</a></li>
<li class="chapter" data-level="9.3.3" data-path="inductive.html"><a href="inductive.html#kruskal"><i class="fa fa-check"></i><b>9.3.3</b> Welch Approximation und Kruskal-Wallis Test</a></li>
<li class="chapter" data-level="9.3.4" data-path="inductive.html"><a href="inductive.html#friedman"><i class="fa fa-check"></i><b>9.3.4</b> Friedman Test</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="inductive.html"><a href="inductive.html#cortest"><i class="fa fa-check"></i><b>9.4</b> Korrelationsanalysen</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="inductive.html"><a href="inductive.html#pearsoncor"><i class="fa fa-check"></i><b>9.4.1</b> Produkt-Moment Korrelation</a></li>
<li class="chapter" data-level="9.4.2" data-path="inductive.html"><a href="inductive.html#rangcor"><i class="fa fa-check"></i><b>9.4.2</b> Rangkorrelationen</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="inductive.html"><a href="inductive.html#regression"><i class="fa fa-check"></i><b>9.5</b> Regressionsmodelle</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="inductive.html"><a href="inductive.html#linregression"><i class="fa fa-check"></i><b>9.5.1</b> Lineare Regression</a></li>
<li class="chapter" data-level="9.5.2" data-path="inductive.html"><a href="inductive.html#logistische-regression"><i class="fa fa-check"></i><b>9.5.2</b> Logistische Regression</a></li>
<li class="chapter" data-level="9.5.3" data-path="inductive.html"><a href="inductive.html#multinomiales-logit-modell"><i class="fa fa-check"></i><b>9.5.3</b> Multinomiales Logit Modell</a></li>
<li class="chapter" data-level="9.5.4" data-path="inductive.html"><a href="inductive.html#propodds"><i class="fa fa-check"></i><b>9.5.4</b> Kumulatives Logit Modell</a></li>
<li class="chapter" data-level="9.5.5" data-path="inductive.html"><a href="inductive.html#poisson-regression"><i class="fa fa-check"></i><b>9.5.5</b> Poisson Regression</a></li>
<li class="chapter" data-level="9.5.6" data-path="inductive.html"><a href="inductive.html#cox"><i class="fa fa-check"></i><b>9.5.6</b> Cox Regression</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="inductive.html"><a href="inductive.html#contingency"><i class="fa fa-check"></i><b>9.6</b> Kontingenztafeln</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="inductive.html"><a href="inductive.html#fisher"><i class="fa fa-check"></i><b>9.6.1</b> Exakter Fisher Test</a></li>
<li class="chapter" data-level="9.6.2" data-path="inductive.html"><a href="inductive.html#chi"><i class="fa fa-check"></i><b>9.6.2</b> Chi Quadrat Tests</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="inductive.html"><a href="inductive.html#voraussetzung"><i class="fa fa-check"></i><b>9.7</b> Voraussetzungen überprüfen</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="inductive.html"><a href="inductive.html#normalverteilung"><i class="fa fa-check"></i><b>9.7.1</b> Normalverteilung</a></li>
<li class="chapter" data-level="9.7.2" data-path="inductive.html"><a href="inductive.html#varianzhomogenitaet"><i class="fa fa-check"></i><b>9.7.2</b> Varianzhomogenität und Homoskedastizität</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="inductive.html"><a href="inductive.html#broom"><i class="fa fa-check"></i><b>9.8</b> Ergebnisse formatieren</a></li>
</ul></li>
<li class="part"><span><b>IV Vertiefung</b></span></li>
<li class="chapter" data-level="10" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html"><i class="fa fa-check"></i><b>10</b> Ergebnisse exportieren</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#intromarkdown"><i class="fa fa-check"></i><b>10.1</b> Wichtige Begriffe</a></li>
<li class="chapter" data-level="10.2" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#markdown"><i class="fa fa-check"></i><b>10.2</b> Berichte erstellen</a></li>
<li class="chapter" data-level="10.3" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#tabellen-umwandeln"><i class="fa fa-check"></i><b>10.3</b> Tabellen umwandeln</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#knitr"><i class="fa fa-check"></i><b>10.3.1</b> Exportieren nach Word und PDF</a></li>
<li class="chapter" data-level="10.3.2" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#latex"><i class="fa fa-check"></i><b>10.3.2</b> Exportieren nach LaTeX</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="ergebnisse-exportieren.html"><a href="ergebnisse-exportieren.html#quarto"><i class="fa fa-check"></i><b>10.4</b> Alternative mit Quarto</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="datatypes.html"><a href="datatypes.html"><i class="fa fa-check"></i><b>11</b> Datenstrukturen</a>
<ul>
<li class="chapter" data-level="11.1" data-path="datatypes.html"><a href="datatypes.html#vec"><i class="fa fa-check"></i><b>11.1</b> Vektor</a></li>
<li class="chapter" data-level="11.2" data-path="datatypes.html"><a href="datatypes.html#matrix"><i class="fa fa-check"></i><b>11.2</b> Matrix</a></li>
<li class="chapter" data-level="11.3" data-path="datatypes.html"><a href="datatypes.html#tibble"><i class="fa fa-check"></i><b>11.3</b> Data.frame und tibble</a></li>
<li class="chapter" data-level="11.4" data-path="datatypes.html"><a href="datatypes.html#lists"><i class="fa fa-check"></i><b>11.4</b> Liste</a></li>
<li class="chapter" data-level="11.5" data-path="datatypes.html"><a href="datatypes.html#umwandlung"><i class="fa fa-check"></i><b>11.5</b> Umwandlungen</a></li>
<li class="chapter" data-level="11.6" data-path="datatypes.html"><a href="datatypes.html#objekte-und-objektorientierung"><i class="fa fa-check"></i><b>11.6</b> Objekte und Objektorientierung</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="iterationmain.html"><a href="iterationmain.html"><i class="fa fa-check"></i><b>12</b> Funktionen wiederholt anwenden</a>
<ul>
<li class="chapter" data-level="12.1" data-path="iterationmain.html"><a href="iterationmain.html#iteration"><i class="fa fa-check"></i><b>12.1</b> Das Copy &amp; Paste Problem</a></li>
<li class="chapter" data-level="12.2" data-path="iterationmain.html"><a href="iterationmain.html#map"><i class="fa fa-check"></i><b>12.2</b> Listenbasierte Berechnungen</a></li>
<li class="chapter" data-level="12.3" data-path="iterationmain.html"><a href="iterationmain.html#for"><i class="fa fa-check"></i><b>12.3</b> for-Schleifen</a></li>
<li class="chapter" data-level="12.4" data-path="iterationmain.html"><a href="iterationmain.html#nest"><i class="fa fa-check"></i><b>12.4</b> Einnisten</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#literaturverzeichnis"><i class="fa fa-check"></i>Literaturverzeichnis</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#verwendete-softwareversionen"><i class="fa fa-check"></i>Verwendete Softwareversionen</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R für empirische Wissenschaften</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datenvorbereitung" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Kapitel 6</span> Datenvorbereitung<a href="datenvorbereitung.html#datenvorbereitung" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>Spalten oder Zeilen auswählen und umbenennen, Spalten hinzufügen und entfernen, Funktion erstellen und Spalteninhalte unter Bedingungen verändern, Spalten trennen oder das Zusammenfügen von Datensätzen sind nur ein kleiner Auszug aus den benötigten Werkzeugen für die Aufbereitung und Bereinigung der eigenen Daten. Bis der Datensatz fehlerfrei und bereit zur Auswertung ist, vergehen häufig mehrere Tage oder sogar Wochen des aktiven Bereinigens.</p>
</blockquote>
<div id="tidyverse" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Einführung<a href="datenvorbereitung.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Die Datenvorbereitung oder auch Datenaufbereitung ist in der Regel der mit Abstand aufwendigste und zeitintensivste Teil der Datenanalyse. Selten liegt nach der Datenerhebung bereits ein perfekt formatierter vor, den man statistisch auswerten kann. Mit den Funktionen des <code>tidyverse</code> ist die Datenvorbereitung unkompliziert und schneller zu bewerkstelligen.</p>
<p>Das <code>tidyverse</code> ist ein Sammelsurium an Packages, die die gleiche Philosophie teilen. Dabei steht die Abkürzung für <strong>tidy</strong> uni<strong>verse</strong>, also einem aufgeräumten Universum. Beim Laden des <code>tidyverse</code> werden neun Packages gemeinsam bereitgestellt, womit man sich im Prinzip nur das einzelne Aufrufen der neun Packages spart. Ausgeführt in R sieht das wie angeführt aus. Unter <em>Conflicts</em> werden Funktionen genannt, die denselben Namen wie andere R Funktionen haben und die von hier an überschrieben werden.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb111-1"><a href="datenvorbereitung.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb112-1"><a href="datenvorbereitung.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Attaching core tidyverse packages <span class="sc">------------</span> tidyverse <span class="dv">2</span>.<span class="fl">0.0</span> <span class="sc">--</span></span>
<span id="cb112-2"><a href="datenvorbereitung.html#cb112-2" aria-hidden="true" tabindex="-1"></a>✔ dplyr     <span class="dv">1</span>.<span class="fl">1.0</span>     ✔ readr     <span class="dv">2</span>.<span class="fl">1.4</span></span>
<span id="cb112-3"><a href="datenvorbereitung.html#cb112-3" aria-hidden="true" tabindex="-1"></a>✔ forcats   <span class="dv">1</span>.<span class="fl">0.0</span>     ✔ stringr   <span class="dv">1</span>.<span class="fl">5.0</span></span>
<span id="cb112-4"><a href="datenvorbereitung.html#cb112-4" aria-hidden="true" tabindex="-1"></a>✔ ggplot2   <span class="dv">3</span>.<span class="fl">4.1</span>     ✔ tibble    <span class="dv">3</span>.<span class="fl">1.8</span></span>
<span id="cb112-5"><a href="datenvorbereitung.html#cb112-5" aria-hidden="true" tabindex="-1"></a>✔ lubridate <span class="dv">1</span>.<span class="fl">9.2</span>     ✔ tidyr     <span class="dv">1</span>.<span class="fl">3.0</span></span>
<span id="cb112-6"><a href="datenvorbereitung.html#cb112-6" aria-hidden="true" tabindex="-1"></a>✔ purrr     <span class="dv">1</span>.<span class="fl">0.1</span> </span>
<span id="cb112-7"><a href="datenvorbereitung.html#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Conflicts <span class="sc">---------------------</span> <span class="fu">tidyverse_conflicts</span>() <span class="sc">--</span></span>
<span id="cb112-8"><a href="datenvorbereitung.html#cb112-8" aria-hidden="true" tabindex="-1"></a>✖ dplyr<span class="sc">::</span><span class="fu">filter</span>() masks stats<span class="sc">::</span><span class="fu">filter</span>()</span>
<span id="cb112-9"><a href="datenvorbereitung.html#cb112-9" aria-hidden="true" tabindex="-1"></a>✖ dplyr<span class="sc">::</span><span class="fu">lag</span>()    masks stats<span class="sc">::</span><span class="fu">lag</span>()</span>
<span id="cb112-10"><a href="datenvorbereitung.html#cb112-10" aria-hidden="true" tabindex="-1"></a>ℹ Use the conflicted package to force all conflicts to become errors</span></code></pre></div>
<ul>
<li><code>ggplot2:</code> Erstellen von Visualisierungen (siehe Kapitel <a href="visual.html#visual">8</a>).</li>
<li><code>tibble:</code> Erweiterung des klassischen <code>data.frames</code> (siehe Kapitel <a href="datatypes.html#tibble">11.3</a>).</li>
<li><code>tidyr:</code> Wechsel zwischen langem und breitem Datenformat (siehe Kapitel <a href="datenvorbereitung.html#tidy">6.6</a>).</li>
<li><code>readr:</code> Einlesen von Dateien (siehe Kapitel <a href="io.html#io">5</a>).</li>
<li><code>purrr:</code> Wiederholtes Anwenden von Funktionen (siehe Kapitel <a href="iterationmain.html#iterationmain">12</a>).</li>
<li><code>dplyr:</code> Funktionen zur Datenvorbereitung.</li>
<li><code>stringr:</code> Veränderung von Buchstaben und Wörtern (siehe Kapitel <a href="datenvorbereitung.html#datastring">6.9</a>).</li>
<li><code>forcats:</code> Manipulation von Faktoren (siehe Kapitel <a href="datenvorbereitung.html#datafactor">6.10</a>).</li>
<li><code>lubridate:</code> Arbeiten mit Zeitdaten (siehe Kapitel <a href="datenvorbereitung.html#datazeit">6.11</a>).</li>
</ul>
<p>Die in diesem Kapitel eingeführten Funktionen zur Datenaufbereitung sind in sich konsistent. Man muss das Prinzip also nur einmal verstehen, um sämtliche Funktionen anwenden zu können. Dabei sind diese durch eine ausdrucksstarke Namensgebung beinahe schon selbsterklärend. Schauen wir uns zunächst eine typische Aneinanderreihung von Befehlen an:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb113-1"><a href="datenvorbereitung.html#cb113-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="datenvorbereitung.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geschlecht, Extraversion) <span class="sc">|&gt;</span> </span>
<span id="cb113-3"><a href="datenvorbereitung.html#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb113-4"><a href="datenvorbereitung.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 82 × 3
  Geschlecht Extraversion Extraversion_lg
  &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;
1 m                   3              1.10
2 m                   3.4            1.22
3 m                   3.3            1.19
4 m                   3.5            1.25
# ℹ 78 more rows</code></pre>
<p>Gelesen würde es wie folgt:</p>
<p>Man nehme den Datensatz <code>big5</code> <code>UND DANN</code></p>
<ul>
<li>wähle die Spalten <code>Geschlecht</code> und <code>Extraversion</code> <code>UND DANN</code></li>
<li>wähle die Zeilen, in denen Geschlecht gleich “m” (für männlich) ist <code>UND DANN</code></li>
<li>mutiere oder verändere die (neue) Spalte <code>Extraversion_lg</code>, wie in diesem Fall beschrieben, durch die logarithmierten Werte der Extraversion.</li>
</ul>
<p>Die anderen Funktionen sind ähnlich intuitiv und nahe an der englischen Sprache benannt. Besonders ist an dieser Stelle die sogenannte Pipe (<code>|&gt;</code>), welche für das Weiterreichen des modifizierten Datensatzes an die nächste Funktion zuständig ist. Der Name des Datensatzes muss nicht in jeder Funktion stehen, da dieser immer das erste Argument der hier behandelten Funktionen darstellt. In dem obigen Beispiel werden zuerst zwei der Spalten ausgewählt. Dann wird das Ergebnis dieses Befehls – also der Datensatz mit den zwei Spalten <code>Geschlecht</code> und <code>Extraversion</code> – im nächsten Schritt der Funktion <code>filter()</code> übergeben.</p>
<div class="idea">
<p>Das Verbindungssymbol <code>|&gt;</code> wird als Pipe bezeichnet. Es kann mit dem Shortcut <kbd>Strg</kbd> + <code>Shift + M</code> (bzw. auf macOS mit <code>Cmd + Shift + M</code>) direkt eingefügt werden. Zuerst muss allerdings innerhalb von RStudio unter <code>Tools/Global options .../Code</code> der Haken bei <code>Use native pipe operator, |&gt; (requires R 4.1+)</code> gesetzt werden. Das Verwenden der in R integrierten Pipe (<code>|&gt;</code>) ist erst ab der R Version <code>4.1.0</code> möglich.</p>
</div>
<p>Die Verwendung der Pipe hat zwei große Vorteile:</p>
<ol style="list-style-type: decimal">
<li>Wir müssen nicht jedes Ergebnis der verschiedenen Funktionen einzeln zwischenspeichern.</li>
<li>Die Verschachtelung mehrerer Funktionen ineinander wird verringert.</li>
</ol>
<p>Trotzdem müssen wir das Ergebnis dieser aneinandergeketteten Funktion irgendwann mit dem Zuweisungspfeil speichern.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb115-1"><a href="datenvorbereitung.html#cb115-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> big5 <span class="sc">|&gt;</span> </span>
<span id="cb115-2"><a href="datenvorbereitung.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geschlecht, Extraversion) <span class="sc">|&gt;</span> </span>
<span id="cb115-3"><a href="datenvorbereitung.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-4"><a href="datenvorbereitung.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion))</span></code></pre></div>
<p>Ohne Pipe müssten wir beim Anwenden jeder Funktion ein Zwischenergebnis abspeichern, was mühsam und fehleranfällig ist. Im Kontext der Datenvorbereitung müssen wir häufig so viele verschiedene Probleme bereinigen, dass zehn bis zwanzig verschiedene Befehle aneinandergekettet werden.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb116-1"><a href="datenvorbereitung.html#cb116-1" aria-hidden="true" tabindex="-1"></a>daten1 <span class="ot">&lt;-</span> <span class="fu">select</span>(daten, Geschlecht, Extraversion) </span>
<span id="cb116-2"><a href="datenvorbereitung.html#cb116-2" aria-hidden="true" tabindex="-1"></a>daten2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(daten1, Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)  </span>
<span id="cb116-3"><a href="datenvorbereitung.html#cb116-3" aria-hidden="true" tabindex="-1"></a>daten3 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(daten2, <span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion))</span></code></pre></div>
<p>Mit Verschachtelung ist eine Kombination mehrerer Funktion innerhalb einer Zeile gemeint. Die ersten beiden Zeilen des vorherigen Beispiels sind äquivalent zu:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb117-1"><a href="datenvorbereitung.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">select</span>(daten, Geschlecht, Extraversion), Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<p>Hier haben wir den Nachteil der erheblich schlechteren Lesbarkeit.</p>
<div class="idea">
<p>Beachte, dass sämtliche Änderungen, die du am Datensatz vollziehst, erst gespeichert werden, wenn du sie mit dem Zuweisungspfeil einer Variable zuweist (siehe Kapitel <a href="vars.html#pfeil">4.2</a>). Falls der gewählte Variablenname bereits vergeben ist (z.B. der bisherige Datensatzname), wird dieser <strong>überschrieben</strong>. Um das rückgängig zu machen, muss der Datensatz dann wieder neu eingelesen werden. Es empfiehlt sich bei einschneidenden Änderungen einen neuen Variablennamen zu wählen.</p>
</div>
<div class="idea">
<p>Ein zentrales Konzept ist die sogenannte Pipe (<code>|&gt;</code>), die verschiedenste Funktionsaufrufe aneinanderbinden kann. Dabei wird der modifizierte Datensatz jeweils an die nächste Funktion weitergeben. In diesem Buch verwenden wir die Pipe (<code>|&gt;</code>), welche seit der Version <code>4.1.0</code> direkt in R integriert ist. Älter ist die Pipe innerhalb des <code>tidyverse</code>, die mit <code>%&gt;%</code> geschrieben wird. Die Funktionsweise der beiden Operatoren unterscheidet sich für die meisten NutzerInnen nicht nennenswert und langfristig wird die Base R Pipe (<code>|&gt;</code>) weiter verbreitet sein.</p>
</div>
</div>
<div id="select" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Spalten auswählen, umbenennen und umsortieren<a href="datenvorbereitung.html#select" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Die Funktionen in diesem Kapitel beschäftigen sich mit der Auswahl, Umbenennung und Umordnung von <strong>Spalten</strong>. Wir haben die Funktion <code>select()</code> bereits im vorherigen Abschnitt kennengelernt. Es können beliebig viele Spalten ausgewählt werden. Dies ist vor allem nützlich, wenn der Datensatz groß ist und man übersichtlich nur die Spalten haben möchte, die zur Auswertung verwendet werden. Zur Auswahl einer Spalte muss nur der Name (ohne Anführungszeichen) der Funktion übergeben werden. Man kann auch direkt in der Funktion die Spalte umbenennen. Dabei muss auf der linken Seite des Gleichheitszeichens der neue Name stehen.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb118-1"><a href="datenvorbereitung.html#cb118-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="datenvorbereitung.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Extraversion, <span class="at">Neuro =</span> Neurotizismus)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 2
  Extraversion Neuro
         &lt;dbl&gt; &lt;dbl&gt;
1          3     1.9
2          3.1   3.4
3          3.4   2.4
4          3.3   4.2
# ℹ 196 more rows</code></pre>
<p>Zur Auswahl der Spalten von <code>Extraversion</code> <strong>bis</strong> <code>O2</code> verwendet man einen Doppelpunkt.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb120-1"><a href="datenvorbereitung.html#cb120-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="datenvorbereitung.html#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Extraversion<span class="sc">:</span>O2)</span></code></pre></div>
<p>Soll nur die Spalte <code>Geschlecht</code> entfernt und der Rest ausgegeben werden, erreicht man dies mit einem Minus vor dem Spaltennamen. Bei mehreren zu entfernenden Spalten müsste man diese zwischen Klammern einbetten (z.B. <code>-(Extraversion:O2)</code>).</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb121-1"><a href="datenvorbereitung.html#cb121-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="datenvorbereitung.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Geschlecht)</span></code></pre></div>
<p>Darüber hinaus können wir sogenannte Helferfunktionen verwenden. Diese können nur in Kombination mit einer anderen Funktion verwendet werden. Ein nützliches Beispiel ist <code>where()</code>, womit beispielsweise alle numerischen Spalten ausgewählt werden können.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb122-1"><a href="datenvorbereitung.html#cb122-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="datenvorbereitung.html#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<p>Eine weitere nützliche Helferfunktion ist <code>starts_with()</code>. So könnte man in diesem Fall beispielsweise alle Fragen zum Persönlichkeitsfaktor Offenheit auswählen, da diese alle mit dem Buchstaben <code>O</code> beginnen.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb123-1"><a href="datenvorbereitung.html#cb123-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb123-2"><a href="datenvorbereitung.html#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;O&quot;</span>))</span></code></pre></div>
<p>Mit der Helferfunktion <code>ends_with()</code> können auf dieselbe Art und Weise Spalten ausgewählt werden, die mit einem bestimmten Character enden (z.B. eine Spalte endend mit dem Buchstaben <code>A</code>), während die Helferfunktion <code>contains()</code> prüft, ob ein Character im Spaltennamen enthalten ist . Darüber hinaus gibt es noch <code>all_of()</code>, um alle zuvor ausgewählten Variablen (Spaltennamen als Character) auszuwählen.</p>
<p>Möchte man hingegen die Spalten nur umbenennen und dabei den gesamten Datensatz behalten, verwendet man anstelle von <code>select()</code> die Funktion <code>rename()</code>. Die Schreibweise der Argumente beim Umbenennen bleibt dabei im Vergleich zu <code>select()</code> gleich.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb124-1"><a href="datenvorbereitung.html#cb124-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb124-2"><a href="datenvorbereitung.html#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sex =</span> Geschlecht)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Sex   Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m              3             1.9     5     1     5
2    30 f              3.1           3.4     5     3     5
3    23 m              3.4           2.4     3     3     5
4    54 m              3.3           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<div class="idea">
<p>Während beide Funktionen Spalten umbenennen können, gibt <code>select()</code> nur die ausgewählten Spalten und <code>rename()</code> hingegen alle Spalten zurück.</p>
</div>
<p>Außerdem können Funktionen zur Umbenennung von Spalten verwendet werden. Dafür müssen wir <code>rename_with()</code> einfach nur die gewünschte Funktion (ohne Klammern) übergeben. In diesem Beispiel werden alle Buchstaben der Spaltennamen in Großbuchstaben umgewandelt. Alternativ könnten auch neue anonyme Funktion direkt innerhalb von <code>rename_with()</code> erstellt werden (siehe Kapitel <a href="datenvorbereitung.html#function">6.4.4</a>).</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb126-1"><a href="datenvorbereitung.html#cb126-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="datenvorbereitung.html#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(toupper)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  ALTER GESCHLECHT EXTRAVERSION NEUROTIZISMUS    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                   3             1.9     5     1     5
2    30 f                   3.1           3.4     5     3     5
3    23 m                   3.4           2.4     3     3     5
4    54 m                   3.3           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Mit dem zusätzlichen Argument <code>.cols</code> könnte man die Umbenennung nur auf einen Teil der Spalten anwenden. Hierbei können wir ebenfalls die zuvor kennengelernten Helferfunktionen verwenden. Möchten wir bspw. nur jene Spaltennamen großschreiben, die mit einem A beginnen, könnten wir dies mit <code>rename_with(.fn = toupper, .cols = starts_with("A"))</code> erreichen.</p>
<p>Bei sehr großen Datensätzen mit vielen Spalten ist die Funktion <code>relocate()</code> äußerst nützlich. Eine neue Spalte wird zum Beispiel immer ans Ende des Datensatzes angefügt. Um diese trotzdem direkt am Anfang betrachten zu können, übergeben wir den Spaltennamen unserer Funktion.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb128-1"><a href="datenvorbereitung.html#cb128-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="datenvorbereitung.html#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(O1)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
     O1 Alter Geschlecht Extraversion Neurotizismus    O2    O3
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     5    36 m                   3             1.9     1     5
2     5    30 f                   3.1           3.4     3     5
3     3    23 m                   3.4           2.4     3     5
4     2    54 m                   3.3           4.2     5     3
# ℹ 196 more rows</code></pre>
<p>Wenn die Spalte nicht zu Beginn, sondern nach einer bestimmten anderen Spalte eingeordnet werden soll, können wir dies mit dem <code>.after</code> Argument festlegen. Hier würde die Spalte <code>O1</code> hinter der Spalte <code>Alter</code> ausgegeben werden.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb130-1"><a href="datenvorbereitung.html#cb130-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb130-2"><a href="datenvorbereitung.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(O1, <span class="at">.after =</span> Alter)</span></code></pre></div>
<p>Auch hier können wir wieder Helferfunktionen wie <code>where()</code> verwenden. Man könnte beispielsweise alle numerischen Spalten hinter alle character Spalten einfügen.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb131-1"><a href="datenvorbereitung.html#cb131-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="datenvorbereitung.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.numeric), <span class="at">.after =</span> <span class="fu">where</span>(is.character))</span></code></pre></div>
<p>Eine weitere nützliche Funktion bei sehr breiten Datensätzen mit vielen Spalten ist <code>colnames()</code>. So können wir auf einem Blick alle Spaltennamen ausgegeben bekommen.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb132-1"><a href="datenvorbereitung.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(big5)</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Alter&quot;         &quot;Geschlecht&quot;    &quot;Extraversion&quot;  &quot;Neurotizismus&quot; &quot;O1&quot;           
[6] &quot;O2&quot;            &quot;O3&quot;           </code></pre>
<p>Von Zeilennamen (<code>rownames()</code>) sollte hingegen grundsätzlich Abstand genommen werden. Falls der Datensatz Zeilennamen enthält, die tatsächlich von Bedeutung sind, sollte man diese mit der Funktion <code>rownames_to_column("Spaltenname")</code> aus dem <code>tibble</code> Package in eine eigene Spalte befördern.</p>
<div class="exercise2">
<p><strong>Übung 6.2.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.2)</code>.</p>
</div>
</div>
<div id="filter" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Zeilen auswählen und umsortieren<a href="datenvorbereitung.html#filter" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Anders als im vorherigen Kapitel beschäftigen sich diese beiden Funktionen mit der Auswahl und Umordnung von <strong>Zeilen</strong>. Der Funktion <code>filter()</code> muss dabei ein logischer Ausdruck übergeben werden. Das Ergebnis der Abfrage muss also immer <code>TRUE</code> oder <code>FALSE</code> zurückgeben (siehe Kapitel <a href="vars.html#datentypen">4.3</a>). Zur Auswahl aller männlichen Probanden würde man <code>Geschlecht == "m"</code> schreiben. Beachte an dieser Stelle das doppelte Gleichheitszeichen.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb134-1"><a href="datenvorbereitung.html#cb134-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="datenvorbereitung.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 82 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                   3             1.9     5     1     5
2    23 m                   3.4           2.4     3     3     5
3    54 m                   3.3           4.2     2     5     3
4    32 m                   3.5           3.1     3     1     5
# ℹ 78 more rows</code></pre>
<p>Um Zeilen neu anzuordnen, benutzt man <code>arrange()</code>. Wenn die Zeilen nach aufsteigendem Alter sortiert werden sollen, muss man lediglich den Spaltennamen übergeben.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb136-1"><a href="datenvorbereitung.html#cb136-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb136-2"><a href="datenvorbereitung.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Alter)</span></code></pre></div>
<p>Für eine absteigende Anordnung muss der Spaltennamen innerhalb der Helferfunktion <code>desc()</code> geschrieben werden.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb137-1"><a href="datenvorbereitung.html#cb137-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a href="datenvorbereitung.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Alter))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  1995 f                   2.5           3.7     4     1     4
2  1964 f                   3.2           2.3     5     1     5
3    60 f                   3             2.7     5     1     5
4    59 m                   2.7           2.3     5     1     5
# ℹ 196 more rows</code></pre>
<p>So sehen wir hier beispielsweise zwei falsch eingetragene Alterswerte. Hier haben zwei Probandinnen nicht das Alter sondern das jeweilige Geburtsjahr in den Datensatz eingetragen. Das müsste vor einer Auswertung noch entsprechend korrigiert werden.</p>
<div class="exercise2">
<p><strong>Übung 6.3.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.3)</code>.</p>
</div>
</div>
<div id="mutate" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Spalten hinzufügen und Spalteninhalte verändern<a href="datenvorbereitung.html#mutate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="single" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Einzelne Spalten<a href="datenvorbereitung.html#single" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Die Funktion <code>mutate()</code> ist eine sehr vielseitig einsetzbare Funktion zum Verändern bestehender oder zum Hinzufügen neuer Spalten. Dabei wird der neue oder bereits bestehende Spaltenname auf die linke Seite des Gleichheitszeichens geschrieben. Auf der rechten Seite kann so ziemlich alles stehen, solange die Funktion eine Spalte zurückgibt, die genauso lang ist wie der Datensatz. Einen Mittelwert über eine ganze Spalte könnte mit <code>mutate()</code> also nicht berechnet werden, da dabei nur ein einziger Wert zurückgeben werden würde. Mit der Funktion <code>log()</code> logarithmieren wir hingegen die Extraversionsausprägungen für jede Person, sodass wir 200 Werte erhalten.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb139-1"><a href="datenvorbereitung.html#cb139-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb139-2"><a href="datenvorbereitung.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion))</span></code></pre></div>
<p>Standardmäßig wird die neue erstellte Spalte hinten als letzte Spalte zum Datensatz hinzugefügt. Möchte man die neue Spalte an einer anderen Position haben, können wir dies mit dem zusätzlichen Argument <code>.after</code> erreichen. So könnte man die neue Spalte namens <code>Extraversion_lg</code> bspw. direkt hinter der Spalte <code>Extraversion</code> einfügen. Dem <code>.after</code> Argument können ebenfalls die in Kapitel <a href="datenvorbereitung.html#select">6.2</a> eingeführten Helferfunktion wie <code>starts_with()</code> und <code>ends_with()</code> übergeben werden.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb140-1"><a href="datenvorbereitung.html#cb140-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb140-2"><a href="datenvorbereitung.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion), <span class="at">.after =</span> Extraversion)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 8
  Alter Geschlecht Extraversion Extraversion_lg Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;           &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                   3              1.10           1.9     5     1     5
2    30 f                   3.1            1.13           3.4     5     3     5
3    23 m                   3.4            1.22           2.4     3     3     5
4    54 m                   3.3            1.19           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Möchten wir die bestehende Spalte <code>Extraversion</code> mit den logarithmierten Werten überschreiben, wählen wir auf der linken Seite des Gleichheitszeichens ebenfalls den Spaltennamen <code>Extraversion</code>. Es wird folglich keine neue Spalte hinzugefügt, sondern nur eine bestehende verändert.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb142-1"><a href="datenvorbereitung.html#cb142-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="datenvorbereitung.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Extraversion =</span> <span class="fu">log</span>(Extraversion))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                  1.10           1.9     5     1     5
2    30 f                  1.13           3.4     5     3     5
3    23 m                  1.22           2.4     3     3     5
4    54 m                  1.19           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Innerhalb eines <code>mutate()</code> Aufrufes können wir auch mehrere Spalten einzeln neu erstellen oder verändern. Die verschiedenen Spalten müssen dabei lediglich mit einem Komma voneinander getrennt werden. Hier logarithmieren wir exemplarisch die mittlere Ausprägung von Extraversion und Neurotizismus. Der Abstand der öffnenden Klammer oben und der schließenden Klammer unten ist aus funktioneller Sicht nicht relevant. Es ist allerdings im Sinne der Lesbarkeit bei Benutzung mehrerer Argumenten unter Umständen sinnvoller, die Argumente auf mehrere Zeilen zu verteilen. Um unsere Berechnung überprüfen zu können, bringen wir noch unsere neuen mit <code>lg</code> endenden Spalten an den Anfang des Datensatzes (siehe Kapitel <a href="datenvorbereitung.html#select">6.2</a>). Dies ist vor allem beim reinen Überprüfen nützlich, da der <code>relocate()</code> Aufruf im Anschluss übersichtlich wieder gelöscht werden kann. Möchte man die Anordnung dauerhaft verändern, ist das zuvor erwähnte Argument <code>.after</code> zu bevorzugen.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb144-1"><a href="datenvorbereitung.html#cb144-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb144-2"><a href="datenvorbereitung.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb144-3"><a href="datenvorbereitung.html#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Extraversion_lg =</span> <span class="fu">log</span>(Extraversion),</span>
<span id="cb144-4"><a href="datenvorbereitung.html#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Neurotizismus_lg =</span> <span class="fu">log</span>(Neurotizismus)</span>
<span id="cb144-5"><a href="datenvorbereitung.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb144-6"><a href="datenvorbereitung.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">ends_with</span>(<span class="st">&quot;lg&quot;</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 9
  Extraversion_lg Neurotizismus_lg Alter Geschlecht Extraversion Neurotizismus    O1    O2
            &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1            1.10            0.642    36 m                   3             1.9     5     1
2            1.13            1.22     30 f                   3.1           3.4     5     3
3            1.22            0.875    23 m                   3.4           2.4     3     3
4            1.19            1.44     54 m                   3.3           4.2     2     5
# ℹ 196 more rows
# ℹ 1 more variable: O3 &lt;dbl&gt;</code></pre>
<div class="exercise2">
<p><strong>Übung 6.4.1.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.4.1)</code>.</p>
</div>
</div>
<div id="across" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Mehrere Spalten<a href="datenvorbereitung.html#across" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Wenn man eine Funktion auf mehrere Spalten anwenden möchte, kann man die Berechnung, wie im vorherigen Kapitel gezeigt, entweder für jede Spalte separat vornehmen oder mithilfe von <code>across()</code> (engl. für herüber) den Prozess abkürzen. Wir wollen schließlich eine Funktion <strong>über</strong> mehrere Spalten anwenden. Innerhalb von <code>across()</code> erfolgt die Auswahl der Spalten dabei genau wie in <code>select()</code> (siehe Kapitel <a href="datenvorbereitung.html#select">6.2</a>). So kann bspw. der Doppelpunkt zur Auswahl eines mehrere Spalten umfassenden Bereiches oder <code>c()</code> zur Auswahl einzelner Spalten verwendet werden. Wichtig ist das Setzen der Klammern an der richtigen Stelle, da die Funktion <code>log()</code> <strong>innerhalb</strong> von <code>across()</code> aufgerufen wird.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb146-1"><a href="datenvorbereitung.html#cb146-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb146-2"><a href="datenvorbereitung.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb146-3"><a href="datenvorbereitung.html#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> Extraversion<span class="sc">:</span>Neurotizismus,</span>
<span id="cb146-4"><a href="datenvorbereitung.html#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> log,</span>
<span id="cb146-5"><a href="datenvorbereitung.html#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">&quot;{.col}_lg&quot;</span>)</span>
<span id="cb146-6"><a href="datenvorbereitung.html#cb146-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 9
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3 Extraversion_lg
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;
1    36 m                   3             1.9     5     1     5            1.10
2    30 f                   3.1           3.4     5     3     5            1.13
3    23 m                   3.4           2.4     3     3     5            1.22
4    54 m                   3.3           4.2     2     5     3            1.19
# ℹ 196 more rows
# ℹ 1 more variable: Neurotizismus_lg &lt;dbl&gt;</code></pre>
<p>Das <code>.names</code> Argument verhindert dabei das Überschreiben der Spalten. Innerhalb der geschweiften Klammern wird hier der Spaltenname für jede in <code>.cols</code> gewählten Spalte nacheinander übergeben und die Endung <code>_lg</code> angehängt. Würden wir den Namen der neu zu erstellenden Spalten nicht explizit mit <code>.names</code> definieren, würden die ursprünglichen Spalten <code>Extraversion</code> und <code>Neurotizismus</code> mit den logarithmierten Werten überschrieben werden. Die eigentlichen Werte wären also nach Abspeichern dieses Zwischenergebnisses nicht mehr im Datensatz enthalten, sondern nur noch die Spalten mit den logarithmierten Werten.</p>
<div class="warning">
<p>Die auf mehrere Spalten anzuwendende Funktion muss innerhalb von <code>across()</code> übergeben werden. Falls ein Fehler auftritt, ist dieser in der Regel auf falsche Positionierung der Klammern zurückzuführen.</p>
</div>
<p>Ein weiterer Unterschied besteht in der manuellen Auswahl einzelner Spalten. Hier müssen wir die einzelnen Spalten im Gegensatz zur Anwendung bei <code>select()</code> in diesem Fall innerhalb von <code>c()</code> übergeben. An dieser Stelle würden die eigentlichen Werte der Spalten <code>Extraversion</code> und <code>Neurotizismus</code> mit den logarithmierten Werten überschrieben werden, da das zuvor beschriebene <code>.names</code> Argument nicht definiert ist.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb148-1"><a href="datenvorbereitung.html#cb148-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb148-2"><a href="datenvorbereitung.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb148-3"><a href="datenvorbereitung.html#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">c</span>(Extraversion, Neurotizismus),</span>
<span id="cb148-4"><a href="datenvorbereitung.html#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> log)</span>
<span id="cb148-5"><a href="datenvorbereitung.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Auch andere bereits in Kapitel <a href="datenvorbereitung.html#select">6.2</a> besprochene Helferfunktionen wie <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code> oder <code>where()</code> können zur Variablensauswahl für das <code>.cols</code> Argument verwendet werden.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb149-1"><a href="datenvorbereitung.html#cb149-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb149-2"><a href="datenvorbereitung.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb149-3"><a href="datenvorbereitung.html#cb149-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb149-4"><a href="datenvorbereitung.html#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> log)</span>
<span id="cb149-5"><a href="datenvorbereitung.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="exercise2">
<p><strong>Übung 6.4.2.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.4.2)</code>.</p>
</div>
</div>
<div id="helfer" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Änderungen unter Bedingungen<a href="datenvorbereitung.html#helfer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Häufig möchte man Funktionen nicht auf alle Zeilen innerhalb der ausgewählten Spalten gleichermaßen anwenden. Wenn wir bspw. eine bestehende Spalte auf bestimmte Art und Weise nur dann verändern wollen, <strong>wenn</strong> eine bestimmte Bedingung zutrifft, erreichen wir dies mit der Funktion <code>if_else()</code>. Wir haben in Kapitel <a href="datenvorbereitung.html#filter">6.3</a> gesehen, dass zwei Probandinnen ihr Geburtsjahr anstelle des Alters in Jahren angegeben haben. Wenn unsere Bedingung (<code>condition</code>) zutrifft, also das Alter in Jahren größer als 120 ist, soll das Jahr der Erhebung (<code>2020</code>) Minus das Alter gerechnet werden. Ansonsten (<code>else</code> bzw. <code>false</code>) wird nur das unveränderte Alter zurückgegeben. Anschließend überprüfen wir noch unsere Berechnung, indem wir das Alter wieder absteigend anordnen.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb150-1"><a href="datenvorbereitung.html#cb150-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb150-2"><a href="datenvorbereitung.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Alter =</span> <span class="fu">if_else</span>(</span>
<span id="cb150-3"><a href="datenvorbereitung.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> Alter <span class="sc">&gt;</span> <span class="dv">120</span>, </span>
<span id="cb150-4"><a href="datenvorbereitung.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> <span class="dv">2020</span> <span class="sc">-</span> Alter, </span>
<span id="cb150-5"><a href="datenvorbereitung.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">false =</span> Alter)</span>
<span id="cb150-6"><a href="datenvorbereitung.html#cb150-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb150-7"><a href="datenvorbereitung.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Alter))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    60 f                   3             2.7     5     1     5
2    59 m                   2.7           2.3     5     1     5
3    59 m                   2.8           1.6     4     2     5
4    58 m                   2.3           2.9     5     1     4
# ℹ 196 more rows</code></pre>
<p>Auf dieselbe Art und Weise könnte man Variablen vor dem Abspeichern umkodieren. Schließlich kann sich spätestens nach 2 Jahren niemand mehr erinnern, ob die 1 bei der Kodierung für Geschlecht nun für männlich oder weiblich stand. Deswegen ist es besser, diese direkt in <code>m</code> oder <code>f</code> abzuspeichern. Wenn das Geschlecht gleich 1 ist (also männlich), schreibe in die Spalte ein <code>m</code> und ansonsten ein <code>f</code>.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb152-1"><a href="datenvorbereitung.html#cb152-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb152-2"><a href="datenvorbereitung.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geschlecht =</span> <span class="fu">if_else</span>(</span>
<span id="cb152-3"><a href="datenvorbereitung.html#cb152-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> Geschlecht <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb152-4"><a href="datenvorbereitung.html#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> <span class="st">&quot;m&quot;</span>, </span>
<span id="cb152-5"><a href="datenvorbereitung.html#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">false =</span> <span class="st">&quot;f&quot;</span>)</span>
<span id="cb152-6"><a href="datenvorbereitung.html#cb152-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Bei mehr als zwei Bedingungen können wir anstelle von <code>if_else()</code> die Funktion <code>case_when()</code> verwenden. Auf der linken Seite der Tilde (<code>~</code>) ist dabei immer die Bedingung angegeben, während auf der rechten Seite steht, was bei zutreffender Bedingung in die Spalte geschrieben werden soll. Allen Werten, auf die keine der explizit genannten Bedingungen zutrifft, wird <code>NA</code> (Akronym für <strong>N</strong>ot <strong>A</strong>vailable, engl. für nicht vorhanden) zugewiesen. Dies kann vermieden werden, indem man am Ende das Argument <code>.default</code> als Bedingung hinzufügt. Achtung, hier wird ein Gleichheitszeichen verwendet, da es sich um ein gewöhnliches Argument handelt.</p>
<p>Somit werden in diesem Beispiel alle ProbandInnen, die bisher keiner Bedingung zugeordnet sind, in die ältesten Altersgruppe kategorisiert. Am Ende ordnen wir unsere neu erstellte Spalte zum Kontrollieren unserer Berechnung wie gewohnt nach vorne.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb153-1"><a href="datenvorbereitung.html#cb153-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb153-2"><a href="datenvorbereitung.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gruppe =</span> <span class="fu">case_when</span>(</span>
<span id="cb153-3"><a href="datenvorbereitung.html#cb153-3" aria-hidden="true" tabindex="-1"></a>    Alter <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;Jungspund&quot;</span>,</span>
<span id="cb153-4"><a href="datenvorbereitung.html#cb153-4" aria-hidden="true" tabindex="-1"></a>    Alter <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> Alter <span class="sc">&lt;=</span> <span class="dv">45</span>  <span class="sc">~</span> <span class="st">&quot;Mittel&quot;</span>,</span>
<span id="cb153-5"><a href="datenvorbereitung.html#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(Alter, <span class="dv">46</span>, <span class="dv">65</span>) <span class="sc">~</span> <span class="st">&quot;Erfahren&quot;</span>,</span>
<span id="cb153-6"><a href="datenvorbereitung.html#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">&quot;Weise&quot;</span>)</span>
<span id="cb153-7"><a href="datenvorbereitung.html#cb153-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb153-8"><a href="datenvorbereitung.html#cb153-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Gruppe)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 8
  Gruppe    Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Mittel       36 m                   3             1.9     5     1     5
2 Mittel       30 f                   3.1           3.4     5     3     5
3 Jungspund    23 m                   3.4           2.4     3     3     5
4 Erfahren     54 m                   3.3           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Die Helferfunktion <code>between()</code> ist eine übersichtliche Alternative zum kombinierten logischen Begriff eine Zeile darüber. Wichtig ist an dieser Stelle, dass der Datentyp auf der linken Seite der Tilde immer logisch sein muss. Der Ausdruck der linken Seite muss also entweder <code>TRUE</code> oder <code>FALSE</code> zurückgeben. Auf der rechten Seite der Tilde muss über alle Bedingungen hinweg immer der gleiche Datentyp sein. Wenn wir also wie hier den Datentyp Character haben, muss bei allen diesen Zuweisungen auf der rechten Seite der Datentyp übereinstimmen.</p>
<p>Ein weiterer praktischer Anwendungsfall ist die Umkodierung von Antwortoptionen bei Fragebogendaten. Angenommen, wir messen auf einer Skala von 1 (trifft gar nicht zu) bis 5 (trifft vollkommen zu) die Ausprägung der Offenheit für neue Erfahrungen. Um Verzerrungen zu vermeiden, sind in einem derartigen Fragebogen immer einige Items verneint gestellt. Normalerweise würde beispielsweise gefragt, ob man gerne neue Sportarten ausprobiert. Würden wir allerdings fragen, ob man <strong>un</strong>gerne neue Sportarten ausprobiert, trifft unsere Skala natürlich nicht mehr zu. Hier wäre 5 <em>trifft gar nicht zu</em> und 1 <em>trifft vollkommen zu</em>. Stellen wir uns vor, dies würde für die erste Frage zur Offenheit <code>O1</code> zutreffen. Zum Vergleich erstellen wir eine neue Spalte namens <code>O1_neu</code>, welche die umkodierten Werte enthält. Um die Ausgabe zu überprüfen lassen wir die originale und neue Spalte mithilfe von <code>relocate()</code> zu Beginn ausgeben (siehe Kapitel <a href="datenvorbereitung.html#select">6.2</a>).</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb155-1"><a href="datenvorbereitung.html#cb155-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb155-2"><a href="datenvorbereitung.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">O1_neu =</span> <span class="fu">case_when</span>(</span>
<span id="cb155-3"><a href="datenvorbereitung.html#cb155-3" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb155-4"><a href="datenvorbereitung.html#cb155-4" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb155-5"><a href="datenvorbereitung.html#cb155-5" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb155-6"><a href="datenvorbereitung.html#cb155-6" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb155-7"><a href="datenvorbereitung.html#cb155-7" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb155-8"><a href="datenvorbereitung.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb155-9"><a href="datenvorbereitung.html#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(O1, O1_neu)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 8
     O1 O1_neu Alter Geschlecht Extraversion Neurotizismus    O2    O3
  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     5      1    36 m                   3             1.9     1     5
2     5      1    30 f                   3.1           3.4     3     5
3     3      3    23 m                   3.4           2.4     3     5
4     2      4    54 m                   3.3           4.2     5     3
# ℹ 196 more rows</code></pre>
<p>Immer wenn die Spalte <code>O1</code> den Werte 1 hat, wird eine 5 daraus gemacht und immer wenn eine 2 angekreuzt wurde, diese mit einer 4 ersetzt. Die 3 können wir so belassen und die 4 und 5 wandeln wir auf die gleiche Art und Weise um. Beachte auch hier, dass wir auf der linken Seite immer eine logische Abfrage und rechts denselben Datentyp (hier Double) vorliegen haben. Auch hier können wir die nützlichen Helferfunktionen <code>contains()</code>, <code>starts_with()</code>, <code>ends_with()</code> und <code>where()</code> auf der linken Seite der Tilde verwenden.</p>
<p>Eine verkürzte Schreibweise für Szenarien des Umkodierens, wie zuvor gezeigt, bietet die Funktion <code>case_match()</code>. So könnte der vorherige Befehl wie folgt abgekürzt werden.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb157-1"><a href="datenvorbereitung.html#cb157-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb157-2"><a href="datenvorbereitung.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">O1_neu =</span> <span class="fu">case_match</span>(</span>
<span id="cb157-3"><a href="datenvorbereitung.html#cb157-3" aria-hidden="true" tabindex="-1"></a>    O1,</span>
<span id="cb157-4"><a href="datenvorbereitung.html#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb157-5"><a href="datenvorbereitung.html#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb157-6"><a href="datenvorbereitung.html#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb157-7"><a href="datenvorbereitung.html#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb157-8"><a href="datenvorbereitung.html#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb157-9"><a href="datenvorbereitung.html#cb157-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Auch Spalten vom Typ Character, wie z.B. die Bezeichnung von Gruppen, können wir so verändern. Soll das Geschlecht bspw. nicht als <code>"f"</code> und <code>"m"</code> sondern als <code>weiblich</code> und <code>maennlich</code> gespeichert werden, müssen wir wie auch bei <code>case_when()</code> die alte Bedingung auf die linke Seite der Tilde und das neue Ergebnis auf die rechte Seite schreiben.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb158-1"><a href="datenvorbereitung.html#cb158-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb158-2"><a href="datenvorbereitung.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geschlecht =</span> <span class="fu">case_match</span>(</span>
<span id="cb158-3"><a href="datenvorbereitung.html#cb158-3" aria-hidden="true" tabindex="-1"></a>    Geschlecht, </span>
<span id="cb158-4"><a href="datenvorbereitung.html#cb158-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;f&quot;</span> <span class="sc">~</span> <span class="st">&quot;weiblich&quot;</span>, </span>
<span id="cb158-5"><a href="datenvorbereitung.html#cb158-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;m&quot;</span> <span class="sc">~</span> <span class="st">&quot;maennlich&quot;</span>)</span>
<span id="cb158-6"><a href="datenvorbereitung.html#cb158-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 maennlich           3             1.9     5     1     5
2    30 weiblich            3.1           3.4     5     3     5
3    23 maennlich           3.4           2.4     3     3     5
4    54 maennlich           3.3           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Mit dieser Funktion können auch verschiedene Schreibweisen beim Ausfüllen von Fragebögen korrigiert werden. In diesem Beispiel gab es in der Spalte <code>Kontakt</code> vier Arten das Wort <em>täglich</em> zu schreiben und zwei für <em>wöchentlich</em>.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb160-1"><a href="datenvorbereitung.html#cb160-1" aria-hidden="true" tabindex="-1"></a>daten <span class="sc">|&gt;</span> </span>
<span id="cb160-2"><a href="datenvorbereitung.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Kontakt =</span> <span class="fu">case_match</span>(</span>
<span id="cb160-3"><a href="datenvorbereitung.html#cb160-3" aria-hidden="true" tabindex="-1"></a>    Kontakt,</span>
<span id="cb160-4"><a href="datenvorbereitung.html#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;taeglich&quot;</span>, <span class="st">&quot;Taeglich&quot;</span>, <span class="st">&quot;täglich&quot;</span>, <span class="st">&quot;Täglich&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Taeglich&quot;</span>,</span>
<span id="cb160-5"><a href="datenvorbereitung.html#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;wöchentlich&quot;</span>, <span class="st">&quot;Wöchentlich&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Woechentlich&quot;</span>)</span>
<span id="cb160-6"><a href="datenvorbereitung.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Nach gleichem Schema könnte man auch eine neue Spalte für Medikament A erstellen, die eine 1 bei Medikamenteneinnahme enthält und sonst eine 0. In der Spalte <code>Medikamente</code> wären bspw. bei manchen PatientInnen der Wirkstoff und bei manchen der Markenname des Medikaments enthalten. Auch hier wird mithilfe des <code>.default</code> Arguments der Wert festgelegt, welcher bei nicht-zutreffen der Bedingung in die Spalte geschrieben wird. Das Beispiel kann um beliebig viele Bedingungen erweitert werden.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb161-1"><a href="datenvorbereitung.html#cb161-1" aria-hidden="true" tabindex="-1"></a>daten <span class="sc">|&gt;</span> </span>
<span id="cb161-2"><a href="datenvorbereitung.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MedikamentA =</span> <span class="fu">case_match</span>(</span>
<span id="cb161-3"><a href="datenvorbereitung.html#cb161-3" aria-hidden="true" tabindex="-1"></a>    Medikamente, </span>
<span id="cb161-4"><a href="datenvorbereitung.html#cb161-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;A_Wirkstoff&quot;</span>, <span class="st">&quot;A_Markenname&quot;</span>) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb161-5"><a href="datenvorbereitung.html#cb161-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="dv">0</span>)</span>
<span id="cb161-6"><a href="datenvorbereitung.html#cb161-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="exercise2">
<p><strong>Übung 6.4.3.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.4.3)</code>.</p>
</div>
</div>
<div id="function" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Eigene Funktionen erstellen<a href="datenvorbereitung.html#function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Obwohl in R selbst oder in zusätzlichen Packages bereits eine Vielzahl von Funktionen enthalten sind, braucht man doch immer wieder eigene Funktionen für spezifische Anwendungsfälle. Dies versuchen wir anhand einer neuen Funktion zu illustrieren, die den Logarithmus einer der Funktion übergebenen Zahl mit zwei summiert. Diese Funktion soll den Namen <code>new_log()</code> haben. Eine Funktion wird mit <code>function()</code> erstellt. Innerhalb der runden Klammern können wir mit einem Komma getrennt beliebig viele Argumente festlegen. An dieser Stelle nehmen wir nur <code>x</code>. Der Name dieses Arguments ist grundsätzlich egal, solange er wie hier in dem Beispiel sowohl innerhalb von <code>function()</code> als auch in <code>log()</code> miteinander übereinstimmt. Die eigentliche Berechnung findet innerhalb der geschweiften Klammern statt. Es ist wichtig, dass wir einmal vor Benutzung diese Funktion durch Ausführen (<code>strg</code> + <code>enter</code>) lokal als Variable speichern.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb162-1"><a href="datenvorbereitung.html#cb162-1" aria-hidden="true" tabindex="-1"></a>new_log <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb162-2"><a href="datenvorbereitung.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(x) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb162-3"><a href="datenvorbereitung.html#cb162-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="idea">
<p>Eigene Funktionen müssen genau wie Packages nach Neustart von R immer wieder neu geladen werden. Dies erreicht man durch einmaliges Ausführen des obigen Befehls zu Beginn der Auswertung. Es gibt in dieser Hinsicht also keinen Unterschied zum Speichern gewöhnlicher Variablen.</p>
</div>
<p>Eine Funktion mit zwei Argumenten, wenn wir beispielsweise zusätzlich noch die zu addierende Zahl innerhalb der Funktion anpassen möchten, könnte wie folgt aussehen.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb163-1"><a href="datenvorbereitung.html#cb163-1" aria-hidden="true" tabindex="-1"></a>new_log <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">zahl =</span> <span class="dv">2</span>) {</span>
<span id="cb163-2"><a href="datenvorbereitung.html#cb163-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(x) <span class="sc">+</span> zahl</span>
<span id="cb163-3"><a href="datenvorbereitung.html#cb163-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Durch das zweite Argument könnte man mit <code>new_log(c(2, 4, 1), zahl = 5)</code> den Logarithmus der drei Zahlen jeweils mit 5 (anstelle von 2) addieren. Da innerhalb der Funktion bereits ein Standardwert (hier 2) angegeben ist, ist die explizite Angabe des Arguments <code>zahl</code> optional. So könnte man zum Logarithmieren und addieren mit 2 einfach <code>new_log(c(2, 4, 1))</code> verwenden.</p>
<p>Einmal erstellt und abgespeichert, können wir die eigene Funktion, wie in Kapitel <a href="datenvorbereitung.html#single">6.4.1</a> bereits gelernt, direkt innerhalb von <code>mutate()</code> anwenden.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb164-1"><a href="datenvorbereitung.html#cb164-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb164-2"><a href="datenvorbereitung.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(Extraversion<span class="sc">:</span>Neurotizismus, new_log))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                  3.10          2.64     5     1     5
2    30 f                  3.13          3.22     5     3     5
3    23 m                  3.22          2.88     3     3     5
4    54 m                  3.19          3.44     2     5     3
# ℹ 196 more rows</code></pre>
<p>Eine Kurzschreibweise zum Definieren eigener Funktionen sind sogenannte Lambda Funktionen. Dies sind anonyme Funktionen, die keinen Funktionsnamen erhalten und daher auch nur einmalig bei Verwendung aufgerufen werden können. Dabei sind zwei Sachen hervorzuheben: Auf der einen Seite muss man immer einen führenden Backslash gefolgt von runden Klammern (<code>\()</code>) hinzufügen. Innerhalb der Klammern wird der Name des Arguments (hier innerhalb von <code>log()</code>) übergeben. Im vorherigen Beispiel haben wir die Werte mit <code>x</code> und die zu addierende Zahl mit <code>zahl</code> bezeichnet. Bei anonymen Funktionen können wir entweder ebenfalls <code>x</code> oder einen beliebigen anderen Namen (z.B. <code>wert</code>) verwenden. Die folgenden zwei Funktionsaufrufe sind äquivalent.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb166-1"><a href="datenvorbereitung.html#cb166-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb166-2"><a href="datenvorbereitung.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(Extraversion<span class="sc">:</span>Neurotizismus, \(x) <span class="fu">log</span>(x) <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb166-3"><a href="datenvorbereitung.html#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="datenvorbereitung.html#cb166-4" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb166-5"><a href="datenvorbereitung.html#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(Extraversion<span class="sc">:</span>Neurotizismus, \(wert) <span class="fu">log</span>(wert) <span class="sc">+</span> <span class="dv">2</span>))</span></code></pre></div>
<p>Als zweites Beispiel verwenden wir die z-Transformation bzw. Standardisierung einer Variable. Die dafür in R integrierte Funktion namens <code>scale()</code> gibt noch zusätzliche Informationen wieder, weswegen der Funktionsaufruf innerhalb von <code>as.numeric()</code> (Umwandlung in einen rein numerischen Datentypen) stehen sollte. Da wir die Spalten Extraversion und Neurotizismus nicht überschreiben, sondern zwei neue Spalten erstellen wollen, wird zusätzlich das <code>.names</code> Argument verwendet. Die neuen Spalten mit den standardisierten Werten würden so die Endung <code>z</code> erhalten.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb167-1"><a href="datenvorbereitung.html#cb167-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb167-2"><a href="datenvorbereitung.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb167-3"><a href="datenvorbereitung.html#cb167-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> Extraversion<span class="sc">:</span>Neurotizismus, </span>
<span id="cb167-4"><a href="datenvorbereitung.html#cb167-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> \(wert) <span class="fu">as.numeric</span>(<span class="fu">scale</span>(wert)),</span>
<span id="cb167-5"><a href="datenvorbereitung.html#cb167-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">&quot;{.col}_z&quot;</span>)</span>
<span id="cb167-6"><a href="datenvorbereitung.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Innerhalb des <code>tidyverse</code> kann eine alternative, nicht mehr empfohlene Schreibweise mit einer führenden Tilde verwendet werden. Dabei muss das Argument der Funktion immer mit <code>.x</code> benannt werden.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb168-1"><a href="datenvorbereitung.html#cb168-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb168-2"><a href="datenvorbereitung.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb168-3"><a href="datenvorbereitung.html#cb168-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> Extraversion<span class="sc">:</span>Neurotizismus, </span>
<span id="cb168-4"><a href="datenvorbereitung.html#cb168-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(.x)),</span>
<span id="cb168-5"><a href="datenvorbereitung.html#cb168-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">&quot;{.col}_z&quot;</span>)</span>
<span id="cb168-6"><a href="datenvorbereitung.html#cb168-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="idea">
<p>Anonyme Funktionen sind eine praktische Möglichkeit, schnell eigene wenig komplexe Funktionen zu erstellen, die man nur an einer Stelle benötigt. So spart man sich das eigenständige Erstellen einer neuen Funktion. Für komplexere Anwendungen ist jedoch das Erstellen einer eigenen Funktion mit <code>function() {}</code> der übersichtlichere und damit empfohlene Weg.</p>
</div>
<div class="idea">
<p>Seit der R Version <code>4.1.0</code> sind anonyme Funktionen mit der <code>\()</code> Syntax ohne zusätzliche Packages direkt in R integriert. Für welche der beiden Optionen man sich letzten Endes entscheidet, hängt von der persönlichen Präferenz ab.</p>
</div>
<p>Mithilfe der Lambda Funktionen könnten wir auf einen Schlag anders als zuvor in Kapitel <a href="datenvorbereitung.html#helfer">6.4.3</a> nicht nur eine Spalte, sondern so viele wie wir wollen, umkodieren. Wir erinnern uns, eine Spalte könnten wir mithilfe von <code>case_when()</code> umkodieren.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb169-1"><a href="datenvorbereitung.html#cb169-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb169-2"><a href="datenvorbereitung.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">O1_neu =</span> <span class="fu">case_when</span>(</span>
<span id="cb169-3"><a href="datenvorbereitung.html#cb169-3" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb169-4"><a href="datenvorbereitung.html#cb169-4" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb169-5"><a href="datenvorbereitung.html#cb169-5" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb169-6"><a href="datenvorbereitung.html#cb169-6" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb169-7"><a href="datenvorbereitung.html#cb169-7" aria-hidden="true" tabindex="-1"></a>    O1 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb169-8"><a href="datenvorbereitung.html#cb169-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Möchten wir in einem Zug die Spalten <code>O1</code>, <code>O2</code> und <code>O3</code> in die richtige Reihenfolge bringen, können wir <code>across()</code> mit <code>case_when()</code> kombinieren. Durch die Lambda Funktion ändert sich der Spaltenname zum Backslash mit der Bezeichnung des Arguments (hier <code>Auspraegung</code>) in Klammern. Dieses Argument wird dann für alle ausgewählten Spalten umkodiert.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb170-1"><a href="datenvorbereitung.html#cb170-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span>  </span>
<span id="cb170-2"><a href="datenvorbereitung.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(O1, O2, O3), \(Auspraegung) <span class="fu">case_when</span>(</span>
<span id="cb170-3"><a href="datenvorbereitung.html#cb170-3" aria-hidden="true" tabindex="-1"></a>    Auspraegung <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb170-4"><a href="datenvorbereitung.html#cb170-4" aria-hidden="true" tabindex="-1"></a>    Auspraegung <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb170-5"><a href="datenvorbereitung.html#cb170-5" aria-hidden="true" tabindex="-1"></a>    Auspraegung <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb170-6"><a href="datenvorbereitung.html#cb170-6" aria-hidden="true" tabindex="-1"></a>    Auspraegung <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb170-7"><a href="datenvorbereitung.html#cb170-7" aria-hidden="true" tabindex="-1"></a>    Auspraegung <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb170-8"><a href="datenvorbereitung.html#cb170-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 7
  Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    36 m                   3             1.9     1     5     1
2    30 f                   3.1           3.4     1     3     1
3    23 m                   3.4           2.4     3     3     1
4    54 m                   3.3           4.2     4     1     3
# ℹ 196 more rows</code></pre>
<p>Alternativ könnten die Variablen innerhalb von <code>across()</code> in diesem Fall auch mit <code>O1:O3</code> oder <code>starts_with("O")</code> ausgewählt werden. Beachte an dieser Stelle auch, dass die schließende Klammer von <code>across()</code> hinter dem vollständigen Funktionsaufruf von <code>case_when()</code> platziert wird.</p>
<div class="exercise2">
<p><strong>Übung 6.4.4.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.4.4)</code>.</p>
</div>
</div>
<div id="zeilenweise-berechnen" class="section level3 hasAnchor" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> Zeilenweise berechnen<a href="datenvorbereitung.html#zeilenweise-berechnen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Für Berechnungen <strong>pro Beobachtung</strong> muss die Funktion <code>rowwise()</code> mit <code>c_across()</code> kombiniert werden. Durch die separate Berechnung für jede Zeile über mehrere Spalten können bspw. Mittelwerte für jede Person in einem bestimmten Merkmal berechnet werden.</p>
<p>Um das Konzept zu illustrieren, soll der Mittelwert pro Person für den Persönlichkeitsfaktor Offenheit berechnet werden. Dieser ergibt sich aus drei einzelnen Fragen zur Offenheit (<code>O1</code>, <code>O2</code>, <code>O3</code>). Zuerst müssen wir die Funktion <code>rowwise()</code> aufrufen, um R das zeilenweise Berechnen zu signalisieren. Innerhalb von <code>mutate()</code> müssen unsere drei Fragen zur Offenheit nun der Funktion <code>c_across()</code> übergeben werden. Beachte das Präfix <code>c_</code> an dieser Stelle. Nach der Berechnung muss die zeilenweise Betrachtung des Datensatzes noch mit <code>ungroup()</code> aufgehoben werden.</p>
<p>Zur Kontrolle holen wir uns die neu erstellte Spalte namens Offenheit wieder an den Anfang des Datensatzes. Auf diesen Aufruf von <code>relocate()</code> kann natürlich beim Abspeichern verzichtet werden.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb172-1"><a href="datenvorbereitung.html#cb172-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb172-2"><a href="datenvorbereitung.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb172-3"><a href="datenvorbereitung.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Offenheit =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(O1<span class="sc">:</span>O3))) <span class="sc">|&gt;</span></span>
<span id="cb172-4"><a href="datenvorbereitung.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-5"><a href="datenvorbereitung.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Offenheit)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 8
  Offenheit Alter Geschlecht Extraversion Neurotizismus    O1    O2    O3
      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      3.67    36 m                   3             1.9     5     1     5
2      4.33    30 f                   3.1           3.4     5     3     5
3      3.67    23 m                   3.4           2.4     3     3     5
4      3.33    54 m                   3.3           4.2     2     5     3
# ℹ 196 more rows</code></pre>
<p>Hinter die Spaltenauswahl mithilfe von <code>c_across()</code> können wir mit einem Komma getrennt wie gewohnt weitere Argumente der jeweiligen Funktion übergeben. Hier sei exemplarisch die Entfernung fehlender Werte mit <code>na.rm = TRUE</code> illustriert.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb174-1"><a href="datenvorbereitung.html#cb174-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb174-2"><a href="datenvorbereitung.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb174-3"><a href="datenvorbereitung.html#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Offenheit =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(O1<span class="sc">:</span>O3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb174-4"><a href="datenvorbereitung.html#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Alternativ könnte man auf diese Weise mit <code>sum()</code> auch die Summe über bestimmte Spalten berechnen. Grundsätzlich können wir so jede Funktion aufrufen, die einen Wert pro Beobachtung zurückgibt (z.B. einen Mittelwert oder einen Median). Falls diese zusammenfassenden Berechnungen nicht pro Beobachtung sondern pro Gruppe oder über alle Beobachtungen ausgegeben werden soll, muss stattdessen <code>summarise()</code> verwendet werden (siehe Kapitel <a href="descr.html#descr">7</a>).</p>
<div class="exercise2">
<p><strong>Übung 6.4.5.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.4.5)</code>.</p>
</div>
</div>
</div>
<div id="umgang-mit-fehlenden-werten-und-duplikaten" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Umgang mit fehlenden Werten und Duplikaten<a href="datenvorbereitung.html#umgang-mit-fehlenden-werten-und-duplikaten" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Zur besseren Illustration der verschiedenen Möglichkeiten verwenden wir an dieser Stelle einen kleinen selbst erstellten Datensatz namens <code>df</code>.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb175-1"><a href="datenvorbereitung.html#cb175-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb175-2"><a href="datenvorbereitung.html#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alter =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="cn">NA</span>, <span class="dv">45</span>, <span class="dv">999</span>),</span>
<span id="cb175-3"><a href="datenvorbereitung.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Geschlecht =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb175-4"><a href="datenvorbereitung.html#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Extraversion =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">999</span>, <span class="dv">2</span>)</span>
<span id="cb175-5"><a href="datenvorbereitung.html#cb175-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-6"><a href="datenvorbereitung.html#cb175-6" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA &quot;m&quot;                   3
3    45 &quot;f&quot;                 999
4   999 &quot;&quot;                    2</code></pre>
<p>Enthalten sind zum einen fehlende Werte als <code>NA</code> und zum anderen als 999 kodiert. <code>NA</code> ist dabei ein besonderer Datentyp, der für <strong>N</strong>ot <strong>A</strong>vailable (engl. für nicht verfügbar) steht. Die Kodierung als 999 ist typisch für Nutzer des alternativen Statistikprogramms SPSS, da dort kein dedizierter Datentyp für fehlende Werte existiert. Wir sind also daran interessiert, diese 999 oder andere nicht passende Werte in <code>NA</code>s sowie umgekehrt <code>NA</code>s in bestimmte Zahlen umzuwandeln.</p>
<p>Einen ersten Überblick über die Anzahl der fehlenden Werte in allen Spalten erhalten wir mit <code>colSums()</code> und <code>is.na()</code>. Erstere Funktion bildet die Summe pro Spalte und letztere fragt ab, ob der Wert fehlend ist.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb177-1"><a href="datenvorbereitung.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df))</span></code></pre></div>
<pre class="bordercode"><code>       Alter   Geschlecht Extraversion 
           1            1            0 </code></pre>
<p>Hier sehen wir richtiger Weise, dass ein Wert in der Altersspalte und zwei Werte in der Geschlechtsspalte fehlen. Möchten wir sehen, auf welche Beobachtungen das genau zutrifft, können wir das in Kapitel <a href="datenvorbereitung.html#filter">6.3</a> kennengelernte <code>filter()</code> verwenden. Zum Beispiel könnte man so sehen, wer keine Geschlechtsangabe gemacht hat.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb179-1"><a href="datenvorbereitung.html#cb179-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb179-2"><a href="datenvorbereitung.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Geschlecht))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 1 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4</code></pre>
<p>Zum Umwandeln von Werten in <code>NA</code> können wir die Funktion <code>na_if()</code> aus dem <code>dplyr</code> Package verwenden. Wenn bspw. in der Spalte Alter die Zahl 999 vorkommt, soll stattdessen <code>NA</code> geschrieben werden. Das ganze müssen wir natürlich innerhalb von <code>mutate()</code> verwenden (siehe Kapitel <a href="datenvorbereitung.html#mutate">6.4</a>).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb181-1"><a href="datenvorbereitung.html#cb181-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb181-2"><a href="datenvorbereitung.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Alter =</span> <span class="fu">na_if</span>(Alter, <span class="dv">999</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA &quot;m&quot;                   3
3    45 &quot;f&quot;                 999
4    NA &quot;&quot;                    2</code></pre>
<p>Dasselbe können wir natürlich mit <code>across()</code> auch gleich auf mehrere Spalten anwenden (siehe Kapitel <a href="datenvorbereitung.html#across">6.4.2</a>). Hierbei müssen jedoch die Datentypen gleich sein.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb183-1"><a href="datenvorbereitung.html#cb183-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb183-2"><a href="datenvorbereitung.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Alter, Extraversion), \(x) <span class="fu">na_if</span>(x, <span class="dv">999</span>)))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA &quot;m&quot;                   3
3    45 &quot;f&quot;                  NA
4    NA &quot;&quot;                    2</code></pre>
<p>So könnte man auch ein <code>NA</code> in jene Zellen schreiben, die einen leeren Character beinhalten.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb185-1"><a href="datenvorbereitung.html#cb185-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb185-2"><a href="datenvorbereitung.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), \(x) <span class="fu">na_if</span>(x, <span class="st">&quot;&quot;</span>)))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA m                     3
3    45 f                   999
4   999 &lt;NA&gt;                  2</code></pre>
<p>Umgekehrt zur Umwandlung von <code>NA</code>s z.B. in die Zahl 999, können wir <code>replace_na()</code> aus selbigen Package benutzen. Wenn in der Spalte Alter ein <code>NA</code> steht, soll dieses mit 999 ersetzt werden.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb187-1"><a href="datenvorbereitung.html#cb187-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb187-2"><a href="datenvorbereitung.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Alter =</span> <span class="fu">replace_na</span>(Alter, <span class="dv">999</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2   999 &quot;m&quot;                   3
3    45 &quot;f&quot;                 999
4   999 &quot;&quot;                    2</code></pre>
<p>Man könnte <code>NA</code>s auch in Abhängigkeit einer Bedingung mithilfe von <code>if_else()</code> oder <code>case_when()</code> zuweisen. So würde bspw. bei allen Personen mit einer Altersangabe über 120 ein fehlender Wert mit <code>NA</code> eingetragen werden.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb189-1"><a href="datenvorbereitung.html#cb189-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb189-2"><a href="datenvorbereitung.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Alter =</span> <span class="fu">if_else</span>(<span class="at">condition =</span> Alter <span class="sc">&gt;</span> <span class="dv">120</span>, <span class="at">true =</span> <span class="cn">NA</span>, <span class="at">false =</span> Alter))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA &quot;m&quot;                   3
3    45 &quot;f&quot;                 999
4    NA &quot;&quot;                    2</code></pre>
<p>Die meisten Statistikfunktionen haben im Regelfall ein Argument namens <code>na.rm</code> (Akronym für <strong>n</strong>ot <strong>a</strong>vailable <strong>r</strong>e<strong>m</strong>ove), welches die fehlenden Werte der entsprechenden Spalte direkt entfernt. Genauer gesagt verwenden diese Funktionen an dieser Stelle die sogenannten <em>Pairwise complete observations</em>. Im letzten Kapitel haben wir die Anwendung bereits im Kontext von zeilenweisen Mittelwertsberechnungen kennengelernt.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb191-1"><a href="datenvorbereitung.html#cb191-1" aria-hidden="true" tabindex="-1"></a>big5 <span class="sc">|&gt;</span> </span>
<span id="cb191-2"><a href="datenvorbereitung.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb191-3"><a href="datenvorbereitung.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Offenheit =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(O1<span class="sc">:</span>O3), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb191-4"><a href="datenvorbereitung.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Eine weitere Möglichkeit ist das Entfernen von Zeilen, die fehlende Werte enthalten. Dies erreichen wir mit <code>drop_na()</code> aus dem <code>dplyr</code> Package. Allerdings entfernt diese Funktion die gesamte Zeile von allen Beobachtungen, in denen auch nur ein <code>NA</code> vorkommt. Wenn du also zwei Spalten auswerten möchtest und in einer dritten für die Auswertung irrelevanten Spalte ist ein fehlender Wert, würde die entsprechende Zeile trotzdem entfernt werden. Hier ist also Vorsicht geboten, um keine Informationen zu verlieren.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb192-1"><a href="datenvorbereitung.html#cb192-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb192-2"><a href="datenvorbereitung.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 2 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    45 &quot;f&quot;                 999
2   999 &quot;&quot;                    2</code></pre>
<p>Alternativ können wir mithilfe von <code>filter()</code> und der logischen Abfrage <code>is.na()</code> das Entfernen von <code>NA</code>s auch auf eine bestimmte Spalte begrenzen (hier Geschlecht). Der Unterschied zum Aufruf zuvor ist das Ausrufezeichen vor <code>is.na()</code>. Es sollen schließlich jene Zeilen ausgegeben werden, die keinen fehlenden Wert in der Spalte Geschlecht haben.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb194-1"><a href="datenvorbereitung.html#cb194-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb194-2"><a href="datenvorbereitung.html#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Geschlecht))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    NA &quot;m&quot;                   3
2    45 &quot;f&quot;                 999
3   999 &quot;&quot;                    2</code></pre>
<p>Exemplarische sei eine doppelte Zeile in den Datensatz <code>df</code> hinzugefügt.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb196-1"><a href="datenvorbereitung.html#cb196-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb196-2"><a href="datenvorbereitung.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Alter =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="cn">NA</span>, <span class="dv">45</span>, <span class="dv">45</span>),</span>
<span id="cb196-3"><a href="datenvorbereitung.html#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Geschlecht =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>),</span>
<span id="cb196-4"><a href="datenvorbereitung.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Extraversion =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">999</span>, <span class="dv">999</span>)</span>
<span id="cb196-5"><a href="datenvorbereitung.html#cb196-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-6"><a href="datenvorbereitung.html#cb196-6" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA m                     3
3    45 f                   999
4    45 f                   999</code></pre>
<p>Mit <code>distinct()</code> können derartige Duplikate entfernt werden.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb198-1"><a href="datenvorbereitung.html#cb198-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb198-2"><a href="datenvorbereitung.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 3
  Alter Geschlecht Extraversion
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1    34 &lt;NA&gt;                  4
2    NA m                     3
3    45 f                   999</code></pre>
<p>Der Funktion können auch Spaltennamen übergeben werden. Dies ist nützlich, wenn zwei Beobachtungen von derselben Person vorhanden sind, man aber bspw. nur die Erstdiagnose behalten möchte. Für dieses Beispiel würde mit <code>arrange()</code> erst die Reihenfolge so verändert, dass die Erstdiagnose bei doppelten Personeneinträgen an erster Stelle steht und anschließend nur die erste Zeile behalten wird.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb200-1"><a href="datenvorbereitung.html#cb200-1" aria-hidden="true" tabindex="-1"></a>daten <span class="sc">|&gt;</span> </span>
<span id="cb200-2"><a href="datenvorbereitung.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Name, Vorname, Erstdiagnose) <span class="sc">|&gt;</span> </span>
<span id="cb200-3"><a href="datenvorbereitung.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Name, Vorname, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Das Argument <code>.keep_all</code> sorgt dafür, dass jeweils die erste Spalte von Duplikaten behalten wird.</p>
</div>
<div id="tidy" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Breites und langes Datenformat<a href="datenvorbereitung.html#tidy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Grundsätzlich unterscheidet man ein sogenanntes breites Datenformat von einem langen Datenformat. Im breiten Datensatz ist jede Spalte eine Variable, jede Zeile eine Beobachtung und jede Zelle ein Wert. Für die meisten Fälle ist das unser gewünschtes Datenformat. In Abbildung <a href="datenvorbereitung.html#fig:wideintro">6.1</a> ist ein einfaches Beispiel für einen breiten Datensatz mit drei Personen und zwei Variablen illustriert.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:wideintro"></span>
<img src="images/wide_intro.png" alt="Breites Datenformat mit drei Personen und drei Variablen." width="331" height="145" />
<p class="caption">
Abbildung 6.1: Breites Datenformat mit drei Personen und drei Variablen.
</p>
</div>
<p>Für das Erstellen mehrfaktorieller Abbildungen und hierarchischer statistischer Modellierung benötigen wir allerdings das lange Datenformat. In Abbildung <a href="datenvorbereitung.html#fig:longintro">6.2</a> ist der zuvor gezeigte Datensatz in ein langes Format umgewandelt.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:longintro"></span>
<img src="images/long_intro.png" alt="Langes Datenformat mit Persönlichkeitsfaktor als Innersubjektfaktor." width="400" height="250" />
<p class="caption">
Abbildung 6.2: Langes Datenformat mit Persönlichkeitsfaktor als Innersubjektfaktor.
</p>
</div>
<p>Im <code>tidyr</code> Package sind zwei Funktionen für genau diese Umwandlungen enthalten. Mit <code>pivot_longer()</code> (engl. für Drehpunkt länger) können wir ein breites Datenformat in ein langes verändern. Die Funktion <code>pivot_wider()</code> fungiert umgekehrt für die Transformation vom langen ins breite Datenformat. Erstere Funktion findet deutlich häufiger Anwendung, da die Daten häufig initial im breiten Format vorhanden sind.</p>
<p>Für das Umformatieren ins lange Datenformat ist es essentiell, einen eindeutigen Personenidentifikator im breiten Datensatz zu haben (z.B. eine Kombination aus Vor- und Nachname mit dem Geburtsjahr). Ansonsten könnten doppelte Zeilen vorkommen, die der Integrität des Datensatzes schaden.. Hier entscheiden wir uns einfach für die Zeilennummer, die wir mit der Funktion <code>row_number()</code> in die Spalte <code>VPN</code> (Akronym für <strong>V</strong>ersuchs<strong>p</strong>ersonen<strong>n</strong>ummer) schreiben.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb201-1"><a href="datenvorbereitung.html#cb201-1" aria-hidden="true" tabindex="-1"></a>wide_big5 <span class="ot">&lt;-</span> big5 <span class="sc">|&gt;</span> </span>
<span id="cb201-2"><a href="datenvorbereitung.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VPN =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb201-3"><a href="datenvorbereitung.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VPN, Geschlecht, Extraversion, Neurotizismus) </span>
<span id="cb201-4"><a href="datenvorbereitung.html#cb201-4" aria-hidden="true" tabindex="-1"></a>wide_big5</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 4
    VPN Geschlecht Extraversion Neurotizismus
  &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;
1     1 m                   3             1.9
2     2 f                   3.1           3.4
3     3 m                   3.4           2.4
4     4 m                   3.3           4.2
# ℹ 196 more rows</code></pre>
<p>Nun müssen wir in der Funktion <code>pivot_longer()</code> nur noch die gewünschten Spalten auswählen. Im obigen Beispiel wären das Extraversion und Neurotizismus. Beachte, dass genau wie bei <code>across()</code> auch hier die Spalten bei einzelner Auswahl der Funktion innerhalb von <code>c()</code> übergeben werden müssen. Es werden zwei neue Spalten erstellt, die erst noch benannt werden müssen. Wie man diese benennt, ist einem selbst überlassen. Der Name für die Spalte mit den Werten wird mit dem Argument <code>values_to</code> und die Spalte mit den Spaltennamen mit <code>names_to</code> festgelegt. Hier entscheiden wir uns für die neuen Spaltennamen <code>"Auspraegung"</code> und <code>"Faktor"</code>. Die Namen müssen hier unbedingt in Anführungszeichen geschrieben werden, da die Spalten noch nicht existieren. Das Ergebnis speichern wir an dieser Stelle als <code>long_big5</code> ab.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb203-1"><a href="datenvorbereitung.html#cb203-1" aria-hidden="true" tabindex="-1"></a>long_big5 <span class="ot">&lt;-</span> wide_big5 <span class="sc">|&gt;</span> </span>
<span id="cb203-2"><a href="datenvorbereitung.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb203-3"><a href="datenvorbereitung.html#cb203-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(Extraversion, Neurotizismus),</span>
<span id="cb203-4"><a href="datenvorbereitung.html#cb203-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Auspraegung&quot;</span>,</span>
<span id="cb203-5"><a href="datenvorbereitung.html#cb203-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Faktor&quot;</span></span>
<span id="cb203-6"><a href="datenvorbereitung.html#cb203-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb203-7"><a href="datenvorbereitung.html#cb203-7" aria-hidden="true" tabindex="-1"></a>long_big5</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 400 × 4
    VPN Geschlecht Faktor        Auspraegung
  &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;
1     1 m          Extraversion          3  
2     1 m          Neurotizismus         1.9
3     2 f          Extraversion          3.1
4     2 f          Neurotizismus         3.4
# ℹ 396 more rows</code></pre>
<p>Zur Auswahl der Spalten können dieselben Helferfunktionen verwendet werden, die in Kapitel <a href="datenvorbereitung.html#select">6.2</a> beschrieben sind (z.B. <code>starts_with()</code>, <code>ends_with()</code> oder <code>everything()</code>). Umgekehrt können wir mithilfe von <code>pivot_wider()</code> den Datensatz <code>long_big5</code> wieder ins breite Datenformat bringen. Dafür müssen wir hier nur festlegen, aus welcher Spalte die Werte (<code>values_from</code>) und woher die Spaltennamen (<code>names_from</code>) kommen sollen. Hier benötigen wir keine Anführungszeichen, da die Spalten bereits in unserem Datensatz enthalten sind.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb205-1"><a href="datenvorbereitung.html#cb205-1" aria-hidden="true" tabindex="-1"></a>long_big5 <span class="sc">|&gt;</span> </span>
<span id="cb205-2"><a href="datenvorbereitung.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb205-3"><a href="datenvorbereitung.html#cb205-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Auspraegung,</span>
<span id="cb205-4"><a href="datenvorbereitung.html#cb205-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Faktor</span>
<span id="cb205-5"><a href="datenvorbereitung.html#cb205-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 4
    VPN Geschlecht Extraversion Neurotizismus
  &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;
1     1 m                   3             1.9
2     2 f                   3.1           3.4
3     3 m                   3.4           2.4
4     4 m                   3.3           4.2
# ℹ 196 more rows</code></pre>
<div class="idea">
<p>Als grobe Daumenregel kann man sich merken, dass man nicht vorhandene Spalten mit Anführungszeichen übergeben muss. Auf bereits im Datensatz vorhandene Spalten kann man hingegen im Regelfall ohne Anführungszeichen zugreifen.</p>
</div>
<div class="exercise2">
<p><strong>Übung 6.6.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.6)</code>.</p>
</div>
</div>
<div id="separate" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Spalten trennen<a href="datenvorbereitung.html#separate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mit den Funktionen namens <code>separate_wider_*()</code> aus dem <code>tidyr</code> Package können Spalten getrennt werden. Dabei unterscheiden wir drei Szenarien, für die jeweils eine eigene Funktion existiert. Die Informationen innerhalb einer Spalte sind getrennt durch</p>
<ul>
<li>einen Trenner (z.B. Unterstrich, Komma, Punkt): <code>separate_wider_delim()</code>,</li>
<li>eine genaue Position: <code>separate_wider_position()</code>,</li>
<li>einen Regex (siehe Kapitel <a href="datenvorbereitung.html#datastring">6.9</a>): <code>separate_wider_regex()</code>.</li>
</ul>
<p>Falls die Spalten anstelle des weiten Datenformates in ein langes gebracht werden sollen, existieren äquivalent dazu die Funktionen <code>separate_longer_delim()</code>, <code>separate_longer_position()</code> und <code>separate_longer_regex()</code>.</p>
<p>Exemplarisch sei hier der im <a href="https://r-empirische-wissenschaften.de">remp</a> Package enthaltene Datensatz <code>big5_zeit</code> geladen.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb207-1"><a href="datenvorbereitung.html#cb207-1" aria-hidden="true" tabindex="-1"></a>big5_zeit</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 5 × 5
    VPN Extrav_T1 Extrav_T2 NeurotFA NeurotFB
  &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     1       3.2       3.3      2.8      3.2
2     2       1.7       1.5      4.1      3.2
3     3       2.8       2.7      3.2      2.8
4     4       4.7       4.2      1.7      2.4
# ℹ 1 more row</code></pre>
<p>Um das hier bestehende Problem klarer zu machen, wandeln wir diesen erst einmal in ein langes Datenformat um (siehe Kapitel <a href="datenvorbereitung.html#tidy">6.6</a>).</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb209-1"><a href="datenvorbereitung.html#cb209-1" aria-hidden="true" tabindex="-1"></a>zeit1 <span class="ot">&lt;-</span> big5_zeit <span class="sc">|&gt;</span> </span>
<span id="cb209-2"><a href="datenvorbereitung.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>NeurotFA, <span class="sc">-</span>NeurotFB) <span class="sc">|&gt;</span> </span>
<span id="cb209-3"><a href="datenvorbereitung.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb209-4"><a href="datenvorbereitung.html#cb209-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> Extrav_T1<span class="sc">:</span>Extrav_T2,</span>
<span id="cb209-5"><a href="datenvorbereitung.html#cb209-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Faktor&quot;</span>,</span>
<span id="cb209-6"><a href="datenvorbereitung.html#cb209-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Auspraegung&quot;</span></span>
<span id="cb209-7"><a href="datenvorbereitung.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb209-8"><a href="datenvorbereitung.html#cb209-8" aria-hidden="true" tabindex="-1"></a>zeit1</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 10 × 3
    VPN Faktor    Auspraegung
  &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt;
1     1 Extrav_T1         3.2
2     1 Extrav_T2         3.3
3     2 Extrav_T1         1.7
4     2 Extrav_T2         1.5
# ℹ 6 more rows</code></pre>
<p>Die Spalte <code>Faktor</code> enthält hier zwei Informationen: den Persönlichkeitsfaktor (<code>Extrav</code>) und den entsprechenden Messzeitpunkt (<code>T1</code>, <code>T2</code>). Es muss mit dem <code>names</code> Argument festgelegt werden, wie die neuen Spalten mit den getrennten Informationen heißen sollen. Die beiden Informationen sind durch einen Unterstrich (<code>_</code>) getrennt, weswegen wir dem <code>delim</code> Argument innerhalb der Funktion <code>separate_wider_delim()</code> diesen Unterstrich als Character übergeben. Würde die Spalte <code>Faktor</code> mehr als zwei Informationen getrennt durch mehrere Unterstriche enthalten, müssten wir dem Argument <code>names</code> entsprechend drei Spaltennamen übergeben.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb211-1"><a href="datenvorbereitung.html#cb211-1" aria-hidden="true" tabindex="-1"></a>zeit1 <span class="sc">|&gt;</span> </span>
<span id="cb211-2"><a href="datenvorbereitung.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb211-3"><a href="datenvorbereitung.html#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> Faktor,</span>
<span id="cb211-4"><a href="datenvorbereitung.html#cb211-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;Faktor&quot;</span>, <span class="st">&quot;Zeitpunkt&quot;</span>),</span>
<span id="cb211-5"><a href="datenvorbereitung.html#cb211-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb211-6"><a href="datenvorbereitung.html#cb211-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 10 × 4
    VPN Faktor Zeitpunkt Auspraegung
  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;
1     1 Extrav T1                3.2
2     1 Extrav T2                3.3
3     2 Extrav T1                1.7
4     2 Extrav T2                1.5
# ℹ 6 more rows</code></pre>
<p>Falls die Informationen innerhalb einer Spalten nicht mit einem Unterstrich, sondern durch unterschiedliche Wortlängen, getrennt sind, verwendet man stattdessen die Funktion <code>separate_wider_position()</code>. Hierbei muss dem <code>widths</code> Argument innerhalb von <code>c()</code> die Anzahl der Buchstaben der ersten und zweiten Information übergeben werden. Der Persönlichkeitsfaktor <code>Neurot</code> hat sechs Buchstaben und die Information über den Messzeitpunkt zwei.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb213-1"><a href="datenvorbereitung.html#cb213-1" aria-hidden="true" tabindex="-1"></a>big5_zeit <span class="sc">|&gt;</span> </span>
<span id="cb213-2"><a href="datenvorbereitung.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Extrav_T1, <span class="sc">-</span>Extrav_T2) <span class="sc">|&gt;</span> </span>
<span id="cb213-3"><a href="datenvorbereitung.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb213-4"><a href="datenvorbereitung.html#cb213-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> NeurotFA<span class="sc">:</span>NeurotFB,</span>
<span id="cb213-5"><a href="datenvorbereitung.html#cb213-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Faktor&quot;</span>,</span>
<span id="cb213-6"><a href="datenvorbereitung.html#cb213-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Auspraegung&quot;</span></span>
<span id="cb213-7"><a href="datenvorbereitung.html#cb213-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb213-8"><a href="datenvorbereitung.html#cb213-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_position</span>(</span>
<span id="cb213-9"><a href="datenvorbereitung.html#cb213-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> Faktor,</span>
<span id="cb213-10"><a href="datenvorbereitung.html#cb213-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="at">Faktor =</span> <span class="dv">6</span>, <span class="at">Zeitpunkt =</span> <span class="dv">2</span>)</span>
<span id="cb213-11"><a href="datenvorbereitung.html#cb213-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 10 × 4
    VPN Faktor Zeitpunkt Auspraegung
  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;
1     1 Neurot FA                2.8
2     1 Neurot FB                3.2
3     2 Neurot FA                4.1
4     2 Neurot FB                3.2
# ℹ 6 more rows</code></pre>
<div class="exercise2">
<p><strong>Übung 6.7.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.7)</code>.</p>
</div>
</div>
<div id="datensätze-zusammenführen" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Datensätze zusammenführen<a href="datenvorbereitung.html#datensätze-zusammenführen" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In der Praxis hat man häufig nicht nur einen Datensatz vorliegen, der alle notwendigen Informationen enthält. Stattdessen sind oft die eigentlichen Daten der Studie in einem Datensatz, die demographischen Daten wie Geschlecht und Alter in einem zweiten und Laborwerte wiederum in einem anderen Datensatz. Andere mögliche Szenarien sind mehrere Untersucher oder verschiedenen Messzeitpunkte. Welcher Grund auch immer für separate Datensätze verantwortlich ist, vor der Auswertung müssen diese zusammengeführt werden.</p>
<p>Um dieses Prinzip zu illustrieren, haben wir zwei Datensätze mit Informationen über den Puls, Vorhandensein einer Blasenentleerungsstörung und die Anzahl an Infektionen innerhalb von zwei Jahren. Diese wurden von zwei Untersuchern erhoben, weswegen diese in dem Datensatz <code>df_oben</code> und <code>df_unten</code> vorliegt.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb215-1"><a href="datenvorbereitung.html#cb215-1" aria-hidden="true" tabindex="-1"></a>df_oben</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 4
  ID        Puls Blasenstoerung Infekt_2j
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 AX161095    83              0         1
2 NM020683   108              1         7
3 IO240576    60              0         2</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb217-1"><a href="datenvorbereitung.html#cb217-1" aria-hidden="true" tabindex="-1"></a>df_unten</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 4
  ID        Puls Blasenstoerung Infekt_2j
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 EW180265    53              1         5
2 CB280682    92              0         0
3 JH051199    65              0         1</code></pre>
<p>Der Datensatz <code>demogr</code> enthält darüber hinaus demographische Daten in Form des biologischen Geschlechts und Alters.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb219-1"><a href="datenvorbereitung.html#cb219-1" aria-hidden="true" tabindex="-1"></a>demogr</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 4 × 3
  ID       Sex   Alter
  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;
1 AX161095 m        28
2 NM020683 f        47
3 IO240576 f        40
4 JH051199 m        24</code></pre>
<p>Solange in beiden Datensätzen dieselben Spalten vorhanden sind, könnte man beide zeilenweise zusammenfügen. In Kapitel <a href="io.html#import">5.1</a> haben wir bereits gesehen, dass mehrere Datensätze mit gleichem Format mithilfe des zusätzlichen Arguments <code>rbind</code> (<strong>r</strong>ow <strong>bind</strong>) verbunden werden können.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb221-1"><a href="datenvorbereitung.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">import_list</span>(dateien, <span class="at">rbind =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Mit der Funktion <code>bind_rows()</code> kann diese Operation auch mit bereits in R geladenen Datensätzen durchgeführt werden. Die einzigen Argumente sind dabei die Namen der Datensätze.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb222-1"><a href="datenvorbereitung.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(df_oben, df_unten)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 6 × 4
  ID        Puls Blasenstoerung Infekt_2j
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 AX161095    83              0         1
2 NM020683   108              1         7
3 IO240576    60              0         2
4 EW180265    53              1         5
5 CB280682    92              0         0
6 JH051199    65              0         1</code></pre>
<p>Problematisch ist bei dieser Funktion, dass nicht überprüft wird, ob Beobachtungen mehrfach vorkommen. Mit einem sogenannten Join (engl. für aneinanderfügen) können zwei Datensätze kontrolliert zusammengefügt werden. Die Funktion <code>full_join()</code> kombiniert alle Informationen aus beiden Datensätzen.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb224-1"><a href="datenvorbereitung.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(df_oben, df_unten)</span></code></pre></div>
<pre class="bordercode"><code>Joining with `by = join_by(ID, Puls, Blasenstoerung, Infekt_2j)`</code></pre>
<pre class="bordercode"><code># A tibble: 6 × 4
  ID        Puls Blasenstoerung Infekt_2j
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 AX161095    83              0         1
2 NM020683   108              1         7
3 IO240576    60              0         2
4 EW180265    53              1         5
5 CB280682    92              0         0
6 JH051199    65              0         1</code></pre>
<p>Da in diesem Beispiel alle Spalten aus beiden Datensätzen integriert werden sollen, muss zusätzlich das <code>by</code> Argument nicht spezifiziert werden. Es wird eine Benachrichtigung ausgegeben, dass nach den Spalten <code>ID</code>, <code>Puls</code>, <code>Blasenstoerung</code> und <code>Infekt_2j</code> zusammengefügt wurde. Vorsicht ist geboten, wenn es Überschneidung in den Datensätzen gibt (z.B. die gleiche Person in beiden Datensätzen aber mit unterschiedlichen Werten in einer gleichnamigen Spalte). Daher sollte bspw. ein zweiter Messzeitpunkt direkt innerhalb des Spaltennamens entsprechend gekennzeichnet werden (z.B. <code>Puls_T1</code> und <code>Puls_T2</code>).</p>
<p>Sollen in den linken Datensatz (1. Argument, hier <code>df_oben</code>) die Informationen eines zweiten Datensatzes (2. Argument, hier <code>demogr</code>) in Abhängigkeit der Übereinstimmung einer dritten Spalte (<code>by</code> Argument, hier <code>ID</code>) eingefügt werden, verwenden wir <code>left_join()</code>.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb227-1"><a href="datenvorbereitung.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(df_oben, demogr, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 6
  ID        Puls Blasenstoerung Infekt_2j Sex   Alter
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 AX161095    83              0         1 m        28
2 NM020683   108              1         7 f        47
3 IO240576    60              0         2 f        40</code></pre>
<p>Obwohl in <code>demogr</code> die demographischen Informationen von vier Personen enthalten sind, werden an dieser Stelle nur jene drei an <code>df_oben</code> angehängt, deren <code>ID</code> mit der in <code>df_oben</code> übereinstimmt. Wenn der linke Datensatz in den rechten integriert werden soll, kann man äquivalent dazu <code>right_join()</code> benutzen.</p>
<p>Wenn hingegen alle <code>ID</code>s vorhanden sind, allerdings einige demographische Informationen fehlen, werden diese mit <code>NA</code> (<strong>n</strong>ot <strong>a</strong>vailable, engl. für nicht vorhanden) angegeben. Um das zu illustrieren, werden erst <code>df_oben</code> und <code>df_unten</code> zusammengefügt.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb229-1"><a href="datenvorbereitung.html#cb229-1" aria-hidden="true" tabindex="-1"></a>df_alle <span class="ot">&lt;-</span> <span class="fu">full_join</span>(df_oben, df_unten)</span></code></pre></div>
<pre class="bordercode"><code>Joining with `by = join_by(ID, Puls, Blasenstoerung, Infekt_2j)`</code></pre>
<p>Anschließend joinen wir wie zuvor eingeführt in Abhängigkeit der <code>ID</code>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb231-1"><a href="datenvorbereitung.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(df_alle, demogr, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>) </span></code></pre></div>
<pre class="bordercode"><code># A tibble: 6 × 6
  ID        Puls Blasenstoerung Infekt_2j Sex   Alter
  &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 AX161095    83              0         1 m        28
2 NM020683   108              1         7 f        47
3 IO240576    60              0         2 f        40
4 EW180265    53              1         5 &lt;NA&gt;     NA
5 CB280682    92              0         0 &lt;NA&gt;     NA
6 JH051199    65              0         1 m        24</code></pre>
<p>Wenn wir nur diejenigen Werte integrieren möchten, die in beiden Datensätzen enthalten sind, verwenden wir <code>inner_join()</code>. Abschließend gibt es noch zwei Funktionen, die nicht direkt zusammenführen, sondern nur eine Bedingung prüfen und davon abhängig den ersten (linken) Datensatz zurückgeben. Die Funktion <code>semi_join()</code> gibt nur jene Werte aus dem ersten Datensatz zurück, welche im ersten (linken) und zweiten (rechten) vorkommen. Die Funktion <code>anti_join()</code> hingegen gibt nur die Werte aus dem ersten (linken) Datensatz zurück, die <strong>nicht</strong> im zweiten (rechten) Datensatz enthalten sind.</p>
<div class="idea">
<p>Das einfache Zusammenfügen von mehreren Zeilen mit <code>bind_rows()</code> ist risikoreich und sollte genau überprüft werden. Kontrollierter ist das Kombinieren mithilfe der Joins. Diese fügen Datensätze nur dann zusammen, wenn es Übereinstimmungen in weiteren Spalten gibt.</p>
</div>
<div class="exercise2">
<p><strong>Übung 6.8.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.8)</code>.</p>
</div>
</div>
<div id="datastring" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> Buchstaben und Wörter bearbeiten<a href="datenvorbereitung.html#datastring" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Oft muss man entweder die Spaltennamen oder die Inhalte verschiedener Spalten, die Characters enthalten, in irgendeiner Form anpassen. In diesem Kapitel schauen wir uns an, wie man mit Funktionen aus <code>stringr</code> Character ersetzt (<code>str_replace()</code>), extrahiert (<code>str_extract()</code>) und entdeckt (<code>str_detect()</code>). Das Präfix <code>str</code> steht dabei für String – einem anderen Wort für Character.</p>
<p>Ein häufiges Ärgernis im Kontext von Programmiersprachen sind Umlaute, da verschiedene Zeichenkodierungen diese intern unter Umständen anders übersetzen, was auf anderen Betriebssystemen zu Kauderwelsch führen kann. Schauen wir uns im Folgenden an, wie man Umlaute ersetzt. Es ist folgender Satz in der Variable <code>char</code> gespeichert.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb233-1"><a href="datenvorbereitung.html#cb233-1" aria-hidden="true" tabindex="-1"></a>char <span class="ot">&lt;-</span> <span class="st">&quot;Österreich hat 28610 schräge Berge&quot;</span></span></code></pre></div>
<p>Möchte man nun das <strong>eine</strong> <em>ä</em> mit <em>ae</em> ersetzen, verwendet man <code>str_replace()</code>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb234-1"><a href="datenvorbereitung.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(<span class="at">string =</span> char, <span class="at">pattern =</span> <span class="st">&quot;ä&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;ae&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Österreich hat 28610 schraege Berge&quot;</code></pre>
<p>In dem Satz ist allerdings nicht nur ein <em>ä</em> sondern auch ein <em>ö</em> enthalten. Für mehr als eine Anpassung verwendet man <code>str_replace_all()</code>. Die Syntax ist hierbei etwas anders als bisher kennengelernt, da in diesem Fall die <em>alte</em> Bezeichnung auf der linken Seite der jeweiligen Gleichung steht. Alle Änderungen müssen innerhalb von <code>c()</code> übergeben werden.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb236-1"><a href="datenvorbereitung.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="at">string =</span> char, <span class="fu">c</span>(<span class="st">&quot;ä&quot;</span> <span class="ot">=</span> <span class="st">&quot;ae&quot;</span>, <span class="st">&quot;Ö&quot;</span> <span class="ot">=</span> <span class="st">&quot;Oe&quot;</span>))</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Oesterreich hat 28610 schraege Berge&quot;</code></pre>
<p>Beachte, dass ein Umlaut großgeschrieben ist und die Funktionen <em>case sensitive</em> sind. Das bedeutet, dass wir mit den Befehlen oben nur den kleinen Buchstaben ä und den großen Buchstaben Ö ersetzen.</p>
<p>Aber wie geht man vor, wenn Spaltennamen Umlaute enthalten? Um dem auf den Grund zu gehen, erstellen wir uns einen neuen Datensatz, der die Preise für drei verschiedene Sägen in Österreich enthält.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb238-1"><a href="datenvorbereitung.html#cb238-1" aria-hidden="true" tabindex="-1"></a>umlaut <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb238-2"><a href="datenvorbereitung.html#cb238-2" aria-hidden="true" tabindex="-1"></a>  Säge <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Häxler&quot;</span>, <span class="st">&quot;Sünde3000&quot;</span>, <span class="st">&quot;Lölf4&quot;</span>),</span>
<span id="cb238-3"><a href="datenvorbereitung.html#cb238-3" aria-hidden="true" tabindex="-1"></a>  Ö<span class="at">sterreich =</span> <span class="fu">c</span>(<span class="fl">10.45</span>, <span class="fl">4.60</span>, <span class="fl">9.70</span>)</span>
<span id="cb238-4"><a href="datenvorbereitung.html#cb238-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb238-5"><a href="datenvorbereitung.html#cb238-5" aria-hidden="true" tabindex="-1"></a>umlaut</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 2
  Säge      Österreich
  &lt;chr&gt;          &lt;dbl&gt;
1 Häxler          10.4
2 Sünde3000        4.6
3 Lölf4            9.7</code></pre>
<p>Die Namen enthalten jeweils einen Umlaut. Möchten wir alle Spaltennamen von Umlauten befreien, könnten wir dies mithilfe von <code>rename_with()</code> und <code>str_replace_all()</code> erreichen. An dieser Stelle verwenden wir eine im Kapitel <a href="datenvorbereitung.html#function">6.4.4</a> bereits eingeführte Lambda Funktion, um die Funktion auf alle Spalten anzuwenden.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb240-1"><a href="datenvorbereitung.html#cb240-1" aria-hidden="true" tabindex="-1"></a>umlaut <span class="sc">|&gt;</span> </span>
<span id="cb240-2"><a href="datenvorbereitung.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(\(x) <span class="fu">str_replace_all</span>(</span>
<span id="cb240-3"><a href="datenvorbereitung.html#cb240-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> x, </span>
<span id="cb240-4"><a href="datenvorbereitung.html#cb240-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;ä&quot;</span> <span class="ot">=</span> <span class="st">&quot;ae&quot;</span>, <span class="st">&quot;ö&quot;</span> <span class="ot">=</span> <span class="st">&quot;oe&quot;</span>, <span class="st">&quot;ü&quot;</span> <span class="ot">=</span> <span class="st">&quot;ue&quot;</span>, <span class="st">&quot;Ä&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ae&quot;</span>, <span class="st">&quot;Ö&quot;</span> <span class="ot">=</span> <span class="st">&quot;Oe&quot;</span>, <span class="st">&quot;Ü&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ue&quot;</span>)</span>
<span id="cb240-5"><a href="datenvorbereitung.html#cb240-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 2
  Saege     Oesterreich
  &lt;chr&gt;           &lt;dbl&gt;
1 Häxler           10.4
2 Sünde3000         4.6
3 Lölf4             9.7</code></pre>
<p>Zum Ändern von Umlauten innerhalb von Spalten muss <code>str_replace_all()</code>, wie in Kapitel <a href="datenvorbereitung.html#across">6.4.2</a> kennengelernt, innerhalb von <code>mutate()</code> in Kombination von <code>across()</code> verwendet werden. So könnte man alle Spalten, die vom Datentyp Character sind, von Umlauten befreien.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb242-1"><a href="datenvorbereitung.html#cb242-1" aria-hidden="true" tabindex="-1"></a>umlaut <span class="sc">|&gt;</span> </span>
<span id="cb242-2"><a href="datenvorbereitung.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), \(x) <span class="fu">str_replace_all</span>(</span>
<span id="cb242-3"><a href="datenvorbereitung.html#cb242-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> x, </span>
<span id="cb242-4"><a href="datenvorbereitung.html#cb242-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;ä&quot;</span> <span class="ot">=</span> <span class="st">&quot;ae&quot;</span>, <span class="st">&quot;ö&quot;</span> <span class="ot">=</span> <span class="st">&quot;oe&quot;</span>, <span class="st">&quot;ü&quot;</span> <span class="ot">=</span> <span class="st">&quot;ue&quot;</span>, <span class="st">&quot;Ä&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ae&quot;</span>, <span class="st">&quot;Ö&quot;</span> <span class="ot">=</span> <span class="st">&quot;Oe&quot;</span>, <span class="st">&quot;Ü&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ue&quot;</span>)</span>
<span id="cb242-5"><a href="datenvorbereitung.html#cb242-5" aria-hidden="true" tabindex="-1"></a>  )))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 3 × 2
  Säge       Österreich
  &lt;chr&gt;           &lt;dbl&gt;
1 Haexler          10.4
2 Suende3000        4.6
3 Loelf4            9.7</code></pre>
<p>Für das Extrahieren von Buchstaben oder Zahlen können wir <code>str_extract()</code> verwenden. Wir nehmen wieder unseren Beispielsatz von oben, der als <code>char</code> gespeichert ist. Es ist möglich, die Zahl mithilfe eines sogenannten Regex zu erkennen (Akronym für <strong>Reg</strong>ular <strong>Ex</strong>pression). Regex sind grundsätzlich sehr komplex selbst zu schreiben. In der Praxis muss man in der Regel nur online nach dem gewünschten Regex suchen, ohne die genaue Syntax zu verstehen.</p>
<p>Um eine Zahl mit mehr als einer Ziffer herauszuholen, könnte man nach dem Regex <code>"\d+"</code> suchen. In R muss noch ein zusätzlicher Backslash verwendet werden, wodurch wir den Ausdruck <code>"\\d+"</code> erhalten. Das d steht für <strong>d</strong>igit (engl. für Ziffer) und das Plus für eine oder mehrere Ziffern.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb244-1"><a href="datenvorbereitung.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(char, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;28610&quot;</code></pre>
<p>Angenommen, die Spalten eines Datensatzes mit den Antworten eines Fragebogens starten mit <code>"Q"</code> folgend von Nummer, Namen und der genauen Beschreibung. Ein Beispiel hierfür wäre die 12. Frage zur Risikowahrnehmung mit Antwortschema in Klammern <code>"Q12_Risikowahrnehmung (0 = "Trifft nicht zu")"</code>. Für die Auswertung möchten wir aufgrund der Leerzeichen und der redundanten Information den hinteren in Klammern geschriebenen Teil löschen. In anderen Worten soll der gesamte Spaltenname bis zum ersten Leerzeichen extrahiert werden. Ein möglicher Regex dafür wäre <code>([^\\s]+)</code>. Beachte auch in diesem Fall, dass bei jedem Backslash für einen Regex aus dem Internet innerhalb von R ein zweiter Backslash hinzugefügt werden muss.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb246-1"><a href="datenvorbereitung.html#cb246-1" aria-hidden="true" tabindex="-1"></a>daten <span class="sc">|&gt;</span> </span>
<span id="cb246-2"><a href="datenvorbereitung.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(</span>
<span id="cb246-3"><a href="datenvorbereitung.html#cb246-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;Q&quot;</span>)</span>
<span id="cb246-4"><a href="datenvorbereitung.html#cb246-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fn =</span> \(x) <span class="fu">str_extract</span>(x, <span class="st">&quot;([^</span><span class="sc">\\</span><span class="st">s]+)&quot;</span>), </span>
<span id="cb246-5"><a href="datenvorbereitung.html#cb246-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Die Funktion <code>str_detect()</code> entdeckt bestimmte Buchstaben, Wörter oder ganze Regex. Dabei gibt die Funktion einen logischen Wert aus (<code>TRUE</code>, <code>FALSE</code>), wenn das Gesuchte gefunden oder nicht gefunden wurde. Das ist daher praktisch, da man diese Funktion für logische Bedingungen innerhalb von <code>if_else()</code>, <code>case_when()</code> oder <code>filter()</code> verwenden kann.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb247-1"><a href="datenvorbereitung.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(char, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code>[1] TRUE</code></pre>
<p>So ermöglicht <code>str_detect()</code> bspw. genauere Abfragen innerhalb von <code>filter()</code> (siehe Kapitel <a href="datenvorbereitung.html#filter">6.3</a>. Alle Käufer der Säge namens <code>Häxler</code> auszugeben, benötigt nur die Funktion <code>filter()</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb249-1"><a href="datenvorbereitung.html#cb249-1" aria-hidden="true" tabindex="-1"></a>umlaut <span class="sc">|&gt;</span> </span>
<span id="cb249-2"><a href="datenvorbereitung.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Säge <span class="sc">==</span> <span class="st">&quot;Häxler&quot;</span>)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 1 × 2
  Säge   Österreich
  &lt;chr&gt;       &lt;dbl&gt;
1 Häxler       10.4</code></pre>
<p>Möchte man alle gekauften Sägen mit dem Buchstaben <code>ä</code> auswählen, könnte man hingegen <code>str_detect()</code> verwenden. Dies ist das zeilen-bezogene Äquivalent zur der bereits kennengelernten Helferfunktion <code>contains()</code>, welche auf der Auswahl von Spalten fokussiert ist (siehe Kapitel <a href="datenvorbereitung.html#select">6.2</a>).</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb251-1"><a href="datenvorbereitung.html#cb251-1" aria-hidden="true" tabindex="-1"></a>umlaut <span class="sc">|&gt;</span> </span>
<span id="cb251-2"><a href="datenvorbereitung.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(Säge, <span class="st">&quot;ä&quot;</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 1 × 2
  Säge   Österreich
  &lt;chr&gt;       &lt;dbl&gt;
1 Häxler       10.4</code></pre>
<div class="idea">
<p>In der Praxis müssen die Funktionen aus dem <code>stringr</code> Package in der Regel in Kombination mit <code>mutate()</code> oder <code>rename_with()</code> verwendet werden. Einen weiteren Anwendungsfall stellt der Umbruch langer Achsenbeschriftung durch <code>str_wrap()</code> bei der Erstellung von Visualisierungen dar.</p>
</div>
<div class="exercise2">
<p><strong>Übung 6.9.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.9)</code>.</p>
</div>
</div>
<div id="datafactor" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> Faktoren verändern<a href="datenvorbereitung.html#datafactor" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Falls du nicht mehr im Kopf hast, was genau Faktoren sind, schaue dir noch einmal Kapitel <a href="vars.html#factor">4.3.2</a> an. Faktoren sind vor allem zur automatischen Erstellung von Dummy Variablen für Regressionsmodelle und das Umbenennen oder Ändern der Reihenfolge beim Erstellen von Visualisierungen nützlich. Dummy Variablen stellen binäre (0, 1) Variablen dar, welche für nominale Merkmale mit mehr als zwei Ausprägungen im Kontext von Regressionsmodellen erstellt werden müssen. Es wird so eine Referenzkategorie festlegt, mit der die anderen Kategorien verglichen werden können.</p>
<p>Im Folgenden schauen wir uns Beispiele an, wie man mit Funktionen aus dem <code>forcats</code> Package Faktoren umbenennen (<code>fct_recode()</code>) und deren Reihenfolge ändern (<code>fct_relevel()</code>, <code>fct_reorder()</code>) kann. Dafür verwenden wir die Spalte <code>Gruppe</code> aus dem <code>big5_mod</code> Datensatz mit den Faktorstufen (oder Level) <em>Jung</em>, <em>Mittel</em> und <em>Weise</em>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb253-1"><a href="datenvorbereitung.html#cb253-1" aria-hidden="true" tabindex="-1"></a>big5_mod <span class="sc">|&gt;</span> </span>
<span id="cb253-2"><a href="datenvorbereitung.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Gruppe)</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 6
  Gruppe Alter Geschlecht Extraversion Neurotizismus    ID
  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt;
1 Mittel    36 m                   3             1.9     1
2 Jung      30 f                   3.1           3.4     2
3 Jung      23 m                   3.4           2.4     3
4 Weise     54 m                   3.3           4.2     4
# ℹ 196 more rows</code></pre>
<p>Um die Veränderungen der Faktorstufen besser darstellen zu können, ziehen wir uns die Spalte <code>Gruppe</code> aus dem Datensatz heraus (siehe Kapitel <a href="vars.html#dollar">4.5</a>). Zuvor müssen wir die Spalte allerdings noch zum Datentyp Faktor umwandeln. Dafür übergibt man der Funktion <code>factor()</code> den Spaltennamen sowie die Faktorstufen (<code>levels</code>).</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb255-1"><a href="datenvorbereitung.html#cb255-1" aria-hidden="true" tabindex="-1"></a>big5_mod <span class="ot">&lt;-</span> big5_mod <span class="sc">|&gt;</span> </span>
<span id="cb255-2"><a href="datenvorbereitung.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gruppe =</span> <span class="fu">factor</span>(Gruppe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Jung&quot;</span>, <span class="st">&quot;Mittel&quot;</span>, <span class="st">&quot;Weise&quot;</span>)))</span>
<span id="cb255-3"><a href="datenvorbereitung.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="datenvorbereitung.html#cb255-4" aria-hidden="true" tabindex="-1"></a>faktoren <span class="ot">&lt;-</span> big5_mod<span class="sc">$</span>Gruppe</span></code></pre></div>
<p>Alternativ könnte auch <code>as.factor(Gruppe)</code> aufgerufen werden, allerdings werden so nur bestehende Stufen zu Faktoren umgewandelt. Wenn bspw. eine Erkrankung in der eigenen Stichprobe nie vorkommt, würde das später nicht angezeigt werden. Mit dem expliziten Festlegen aller grundsätzlich möglichen Faktorstufen mithilfe des <code>levels</code> Arguments innerhalb von <code>factor()</code> würde bei weiterer Auswertung eine Häufigkeit von 0 für die fehlende Kategorie ausgegeben werden.</p>
<p>Zum Anzeigen der Faktorstufen verwenden wir die Funktion <code>levels()</code>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb256-1"><a href="datenvorbereitung.html#cb256-1" aria-hidden="true" tabindex="-1"></a>faktoren <span class="sc">|&gt;</span> </span>
<span id="cb256-2"><a href="datenvorbereitung.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>()</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Jung&quot;   &quot;Mittel&quot; &quot;Weise&quot; </code></pre>
<p>Dass die Reihenfolge schon der Altersreihenfolge entspricht, liegt nur daran, dass wir die Faktorstufen oben genau spezifiziert haben. Ansonsten können durchaus unerwartete Reihenfolgen der Faktorstufen auftreten. Es lohnt sich also in jedem Fall ein Blick in die Faktorstufen zu werfen, bevor man sie verwendet. Möchte man einzelne Faktoren umbenennen, verwendet man <code>fct_recode()</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb258-1"><a href="datenvorbereitung.html#cb258-1" aria-hidden="true" tabindex="-1"></a>faktoren <span class="sc">|&gt;</span> </span>
<span id="cb258-2"><a href="datenvorbereitung.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct_recode</span>(<span class="at">Alt =</span> <span class="st">&quot;Weise&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb258-3"><a href="datenvorbereitung.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>()</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Jung&quot;   &quot;Mittel&quot; &quot;Alt&quot;   </code></pre>
<p>Mit der Funktion <code>fct_relevel()</code> kann ein Faktor als erste Stufe definiert werden.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb260-1"><a href="datenvorbereitung.html#cb260-1" aria-hidden="true" tabindex="-1"></a>faktoren <span class="sc">|&gt;</span> </span>
<span id="cb260-2"><a href="datenvorbereitung.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct_relevel</span>(<span class="st">&quot;Mittel&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb260-3"><a href="datenvorbereitung.html#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>()</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Mittel&quot; &quot;Jung&quot;   &quot;Weise&quot; </code></pre>
<p>Zum Ändern der gesamten Reihenfolge kann man beliebig viele weitere Faktorstufen der Funktion übergeben.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb262-1"><a href="datenvorbereitung.html#cb262-1" aria-hidden="true" tabindex="-1"></a>faktoren <span class="sc">|&gt;</span> </span>
<span id="cb262-2"><a href="datenvorbereitung.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct_relevel</span>(<span class="st">&quot;Weise&quot;</span>, <span class="st">&quot;Mittel&quot;</span>, <span class="st">&quot;Jung&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb262-3"><a href="datenvorbereitung.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>()</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Weise&quot;  &quot;Mittel&quot; &quot;Jung&quot;  </code></pre>
<p>In der Praxis werden sämtlich Funktion aus dem <code>forcats</code> Package meistens innerhalb von <code>mutate()</code> verwendet. So könnte man die Referenzgruppe, also die erste Faktorstufe, für die ältestes Altersgruppe festlegen.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb264-1"><a href="datenvorbereitung.html#cb264-1" aria-hidden="true" tabindex="-1"></a>big5_mod <span class="sc">|&gt;</span> </span>
<span id="cb264-2"><a href="datenvorbereitung.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gruppe =</span> <span class="fu">fct_relevel</span>(Gruppe, <span class="st">&quot;Weise&quot;</span>))</span></code></pre></div>
<p>Wenn die Reihenfolge der Faktoren in absteigender (<code>.desc = TRUE</code>) oder aufsteigender (<code>.desc = FALSE</code>) Reihenfolge z.B. in Abhängigkeit des Mittelwertes einer anderen Spalte (wie dem Ausmaß an Extraversion) sortiert werden soll, verwendet man <code>fct_reorder()</code>. Dabei kann man mit dem Argument <code>.fun</code> die gewünschte Funktion zur Auswertung der zweiten Variable (hier Extraversion) festlegen.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb265-1"><a href="datenvorbereitung.html#cb265-1" aria-hidden="true" tabindex="-1"></a>extraversion <span class="ot">&lt;-</span> big5_mod<span class="sc">$</span>Extraversion</span>
<span id="cb265-2"><a href="datenvorbereitung.html#cb265-2" aria-hidden="true" tabindex="-1"></a>faktoren <span class="sc">|&gt;</span> </span>
<span id="cb265-3"><a href="datenvorbereitung.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct_reorder</span>(extraversion, <span class="at">.fun =</span> mean, <span class="at">.desc =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb265-4"><a href="datenvorbereitung.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>()</span></code></pre></div>
<pre class="bordercode"><code>[1] &quot;Mittel&quot; &quot;Jung&quot;   &quot;Weise&quot; </code></pre>
<p>In unserem Beispiel ist die Ausprägung der Extraversion in der mittleren Altersklasse am höchsten gefolgt von der jüngsten und der ältesten.</p>
<p>Zur Verwendung direkt am Datensatz wird auch hier der Befehl innerhalb von <code>mutate()</code> aufgerufen (siehe Kapitel <a href="datenvorbereitung.html#mutate">6.4</a>). Die erste Spalte ist der umzugruppierende Faktor und die zweite (hier Alter) jene, nach der gereiht werden soll.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb267-1"><a href="datenvorbereitung.html#cb267-1" aria-hidden="true" tabindex="-1"></a>big5_mod <span class="sc">|&gt;</span> </span>
<span id="cb267-2"><a href="datenvorbereitung.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gruppe =</span> <span class="fu">fct_reorder</span>(Gruppe, Alter, <span class="at">.fun =</span> mean, <span class="at">.desc =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 6
  Alter Geschlecht Extraversion Neurotizismus Gruppe    ID
  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt; &lt;fct&gt;  &lt;int&gt;
1    36 m                   3             1.9 Mittel     1
2    30 f                   3.1           3.4 Jung       2
3    23 m                   3.4           2.4 Jung       3
4    54 m                   3.3           4.2 Weise      4
# ℹ 196 more rows</code></pre>
<div class="warning">
<p>Faktoren sollten erst unmittelbar vor Verwendung erstellt und verändert werden. Es kann im Umgang von Faktoren zu seltsamen Fehlermeldungen kommen, da diese innerhalb von R als Integer (Zahl) und nicht als Character (Buchstabenfolge) behandelt werden.</p>
</div>
<div class="exercise2">
<p><strong>Übung 6.10.</strong> (Noch nicht enthalten) Starte die Übung mit <code>uebung_starten(6.10)</code>.</p>
</div>
</div>
<div id="datazeit" class="section level2 hasAnchor" number="6.11">
<h2><span class="header-section-number">6.11</span> Mit Zeitdaten arbeiten<a href="datenvorbereitung.html#datazeit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Für das Arbeiten mit Zeitdaten muss das <code>lubridate</code> Package installiert und geladen sein.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb269-1"><a href="datenvorbereitung.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p>In Kapitel <a href="vars.html#zeitdaten">4.3.3</a> wurden bereits die Datentypen <code>POSIXct</code>, <code>Date</code> und <code>Difftime</code> vorgestellt. Dabei ist <code>POSIXct</code> ein selten erwünschter Datentyp. Wir können mit <code>mutate()</code> in Kombination mit <code>across()</code> aus Kapitel <a href="datenvorbereitung.html#across">6.4.2</a> alle Spalten vom Datentyp <code>POSIXct</code> in den Datentyp <code>Date</code> umwandeln.</p>
<p>Im Datensatz <code>videostream</code> aus dem <a href="https://r-empirische-wissenschaften.de">remp</a> Package liegt die Spalte <code>Watchdate</code> im falschem Format vor. Die Abkürzung <code>&lt;dttm&gt;</code> steht dabei für den Datentyp <code>POSIXct</code>.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb270-1"><a href="datenvorbereitung.html#cb270-1" aria-hidden="true" tabindex="-1"></a>videostream</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 1,493 × 4
  Titel           Staffel   Folge                              Watchdate          
  &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;                              &lt;dttm&gt;             
1 Suits           Staffel 7 Neues Spiel                        2019-07-22 00:00:00
2 Suits           Staffel 1 Patente und andere Unwaegbarkeiten 2019-07-22 00:00:00
3 Death Note      Staffel 1 Ein Geschaeft                      2019-07-21 00:00:00
4 Haus des Geldes Teil 3    Verloren                           2019-07-21 00:00:00
# ℹ 1,489 more rows</code></pre>
<p>Innerhalb von <code>mutate()</code> können wir den Datentyp der Spalte nun verändern (siehe Kapitel <a href="datenvorbereitung.html#single">6.4.1</a>).</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb272-1"><a href="datenvorbereitung.html#cb272-1" aria-hidden="true" tabindex="-1"></a>videostream <span class="sc">|&gt;</span> </span>
<span id="cb272-2"><a href="datenvorbereitung.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Watchdate =</span> <span class="fu">as.Date</span>(Watchdate))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 1,493 × 4
  Titel           Staffel   Folge                              Watchdate 
  &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;                              &lt;date&gt;    
1 Suits           Staffel 7 Neues Spiel                        2019-07-22
2 Suits           Staffel 1 Patente und andere Unwaegbarkeiten 2019-07-22
3 Death Note      Staffel 1 Ein Geschaeft                      2019-07-21
4 Haus des Geldes Teil 3    Verloren                           2019-07-21
# ℹ 1,489 more rows</code></pre>
<p>In größeren Datensätzen möchten wir in der Regel alle falsch formatierten Spalten ändern, welches wir mithilfe von <code>across()</code> erreichen (siehe Kapitel <a href="datenvorbereitung.html#across">6.4.2</a>).</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb274-1"><a href="datenvorbereitung.html#cb274-1" aria-hidden="true" tabindex="-1"></a>videostream <span class="sc">|&gt;</span> </span>
<span id="cb274-2"><a href="datenvorbereitung.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.POSIXct), as.Date))</span></code></pre></div>
<p>Die Funktion <code>as.Date()</code> stößt an ihre Grenzen, wenn das Datum nicht im <code>Jahr-Monat-Tag</code> Format ist (z.B. <code>"2002-02-15"</code>). Daher gibt es im <code>lubridate</code> Package neben <code>ymd()</code> (<strong>y</strong>ear <strong>m</strong>onth <strong>d</strong>ate) für denselben Anwendungsfall wie <code>as.Date()</code> zusätzlich die Funktion <code>dmy()</code> (<strong>d</strong>ay <strong>m</strong>onth <strong>y</strong>ear). Möchte man nur den Tag, Monat oder das Jahr separat aus dem Datum extrahieren, können wir dies mit <code>day()</code>, <code>month()</code> und <code>year()</code> erreichen.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb275-1"><a href="datenvorbereitung.html#cb275-1" aria-hidden="true" tabindex="-1"></a>videostream <span class="sc">|&gt;</span> </span>
<span id="cb275-2"><a href="datenvorbereitung.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb275-3"><a href="datenvorbereitung.html#cb275-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Watchdate =</span> <span class="fu">ymd</span>(Watchdate),</span>
<span id="cb275-4"><a href="datenvorbereitung.html#cb275-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Jahre =</span> <span class="dv">2023</span> <span class="sc">-</span> <span class="fu">year</span>(Watchdate)</span>
<span id="cb275-5"><a href="datenvorbereitung.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Wenn das genaue Datum bekannt ist, können die Daten auch direkt voneinander subtrahiert werden. Dabei wird die Differenz in Tagen angegeben. Möchte man die Zeitdifferenz in Jahren angegeben haben (z.B. beim Alter), muss man durch die Funktion <code>dyears()</code> teilen. Als Argument wird die Anzahl an zu teilenden Jahren übergeben. Äquivalent dazu können wir auch durch Monate (<code>dmonths()</code>) und Tage (<code>ddays()</code>) teilen. So können wir auch auch die Überlebenszeit (<code>OS_Zeit</code>) bei bekanntem Datum der Erstdiagnose berechnen.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb276-1"><a href="datenvorbereitung.html#cb276-1" aria-hidden="true" tabindex="-1"></a>daten <span class="sc">|&gt;</span> </span>
<span id="cb276-2"><a href="datenvorbereitung.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb276-3"><a href="datenvorbereitung.html#cb276-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alter_Diagnose =</span> (<span class="fu">ymd</span>(Erstdiagnose) <span class="sc">-</span> <span class="fu">ymd</span>(Geburtsdatum)) <span class="sc">/</span> <span class="fu">dyears</span>(<span class="dv">1</span>),</span>
<span id="cb276-4"><a href="datenvorbereitung.html#cb276-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_zeit =</span> <span class="fu">ymd</span>(OS_datum) <span class="sc">-</span> <span class="fu">ymd</span>(Erstdiagnose),</span>
<span id="cb276-5"><a href="datenvorbereitung.html#cb276-5" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
</div>
<div id="binäre-antwortmatrix-erstellen" class="section level2 hasAnchor" number="6.12">
<h2><span class="header-section-number">6.12</span> Binäre Antwortmatrix erstellen<a href="datenvorbereitung.html#binäre-antwortmatrix-erstellen" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Im Kontext von Fragebögen ist man häufig an richtiger oder falscher Beantwortung der ProbandInnen interessiert. Mit <code>data_binary()</code> aus dem <a href="https://r-empirische-wissenschaften.de">remp</a> Package kann man den Datensatz in die gewünschte binäre Antwortmatrix umwandeln. Für jede Frage pro Person wird also zurückgegeben, ob das Item richtig (1) oder falsch (0) beantwortet wurde.</p>
<p>Exemplarisch nehmen wir die ersten drei Spalten zur Offenheit für neue Erfahrungen aus dem <code>big5</code> Datensatz.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb277-1"><a href="datenvorbereitung.html#cb277-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> big5 <span class="sc">|&gt;</span> </span>
<span id="cb277-2"><a href="datenvorbereitung.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O1<span class="sc">:</span>O3)</span>
<span id="cb277-3"><a href="datenvorbereitung.html#cb277-3" aria-hidden="true" tabindex="-1"></a>df2</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 3
     O1    O2    O3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     5     1     5
2     5     3     5
3     3     3     5
4     2     5     3
# ℹ 196 more rows</code></pre>
<p>Stell dir vor, bei Frage 1 ist die Antwort 3 richtig, bei Frage 2 die Antwort 2 und bei Item 3 die Antwort 4. Dann würden diese richtigen Antworten dem <code>answers</code> Argument kombiniert übergeben werden.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r bordercode"><code class="sourceCode r"><span id="cb279-1"><a href="datenvorbereitung.html#cb279-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">|&gt;</span> </span>
<span id="cb279-2"><a href="datenvorbereitung.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_binary</span>(<span class="at">answers =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">5</span>))</span></code></pre></div>
<pre class="bordercode"><code># A tibble: 200 × 3
     O1    O2    O3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0     1     1
2     0     0     1
3     0     0     1
4     0     0     0
# ℹ 196 more rows</code></pre>

</div>
</div>



</div>
<script data-goatcounter="https://remp.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="io.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="descr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"toc_depth": 3,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
